!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var s in e)("object"==typeof exports?exports:t)[s]=e[s]}}(self,(function(){return(()=>{"use strict";var t,i={712:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlobalEventType=i.Align=i.LOD=i.ViewPort=void 0,function(t){t.INSIDE="INSIDE",t.OUTSIDE="OUTSIDE",t.INTERSECT="INTERSECT"}(i.ViewPort||(i.ViewPort={})),function(t){t[t.LOD0=0]="LOD0",t[t.LOD1=1]="LOD1",t[t.LOD2=2]="LOD2"}(i.LOD||(i.LOD={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(i.Align||(i.Align={})),function(t){t[t.Emitter=0]="Emitter",t[t.Receiver=1]="Receiver"}(i.GlobalEventType||(i.GlobalEventType={}))},20:function(t,i,e){var s=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),o=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||s(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),o(e(712),i),o(e(5013),i)},5013:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0})},1278:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Color=void 0;const s=e(974),o=e(6645);class n{constructor(t){this.rgbaValue=t,this.hexValue=n.rgbaToHex(this.rgbaValue),this.rgbaString=n.rgbaToString(this.rgbaValue),this.rgbaCSSString=n.rgbaToCSSString(this.rgbaValue)}isEqual(t){return t.rgbaValue[0]===this.rgbaValue[0]&&t.rgbaValue[1]===this.rgbaValue[1]&&t.rgbaValue[2]===this.rgbaValue[2]&&t.rgbaValue[3]===this.rgbaValue[3]}static Random(){return new n(new Uint8ClampedArray([Math.floor((0,s.getRandom)(0,255)),Math.floor((0,s.getRandom)(0,255)),Math.floor((0,s.getRandom)(0,255)),255]))}static hexToRGBA(t){return new Uint8ClampedArray([parseInt(t.slice(1,3),16),parseInt(t.slice(3,5),16),parseInt(t.slice(5,7),16),parseInt(t.slice(7,9),16)])}static _componentToHex(t){let i=t.toString(16);return 1===i.length?"0"+i:i}static rgbaToHex(t){return"#"+n._componentToHex(t[0])+n._componentToHex(t[1])+n._componentToHex(t[2])+n._componentToHex(t[3])}static rgbaToString(t){return`${t[0]}:${t[1]}:${t[2]}:${t[3]}`}static rgbaToCSSString(t){return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${(0,s.normalize)(t[3],0,255).toFixed(3)})`}static scale(t){if(!Array.isArray(t))return void o.Log.error("An array is expected to create a color scale");if(t.length<=1)return void o.Log.error("At least two colors are required to create a color scale");let i=[];return t[0]instanceof Uint8ClampedArray||Array.isArray(t[0])&&"number"==typeof t[0][0]?t.forEach((t=>i.push(new n(t)))):"string"==typeof t[0]?t.forEach((t=>i.push(new n(n.hexToRGBA(t))))):i=t,t=>{t=(0,s.clamp)(t,0,1);let e=(i.length-1)*t,o=Math.floor(e),n=Math.ceil(e);t=e-o;let h=i[o],r=i[n];return"rgba("+h.rgbaValue.map(((i,e)=>(i=(0,s.lerp)(i,r.rgbaValue[e],t),e<3&&(i=Math.round(i)),i)))+")"}}serialize(){return{rgba:[this.rgbaValue[0],this.rgbaValue[1],this.rgbaValue[2],this.rgbaValue[3]]}}static deSerialize(t){return new n(t.rgba)}}i.Color=n},4907:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Connector=void 0;const s=e(7892),o=e(974),n=e(6894),h=e(7055);class r{constructor(t,i,e,s,n={},h=(0,o.getNewUUID)(),r=!1){this.flow=t,this.floatingTip=s,this.style=n,this.id=h,this.style={...l(),...n},this.start=i,this.end=e,this.start&&(this.startNode=this.start.node),this.end&&(this.endNode=this.end.node),i&&e&&(this.floatingTip=null,this.start.connectors.push(this),this.end.connectors.length>0?(this.end.connectors[0].removeConnection(),this.end.connectors[0]=this):this.end.connectors.push(this),r||this.flow.executionGraph.connect(this.startNode,this.endNode),this.start.onConnect(this),this.end.onConnect(this))}get data(){return this._data}set data(t){this._data=t,this.end&&this.end.call("data",this.end,t),this.flow.state!==n.FlowState.Stopped&&this.flow.executionGraph.setDirty(this.endNode)}completeConnection(t){this.start?(this.end=t,this.endNode=this.end.node):(this.start=t,this.startNode=this.start.node),this.start.connectors.includes(this)||this.start.connectors.push(this),this.end.connectors[0]=this,this.floatingTip=null,this.startNode.currHitTerminal&&this.startNode.currHitTerminal.onExit(null,null),this.startNode.currHitTerminal=null,this.endNode.currHitTerminal&&this.endNode.currHitTerminal.onExit(null,null),this.endNode.currHitTerminal=null,this.flow.executionGraph.connect(this.startNode,this.endNode),this.start.onConnect(this),this.end.onConnect(this)}removeConnection(){this.start&&(this.start.connectors.includes(this)&&this.start.connectors.splice(this.start.connectors.indexOf(this),1),this.startNode.currHitTerminal&&(this.startNode.currHitTerminal.onExit(null,null),this.startNode.currHitTerminal=null)),this.end&&(this.end.connectors.includes(this)&&this.end.connectors.splice(this.end.connectors.indexOf(this),1),this.endNode.currHitTerminal&&(this.endNode.currHitTerminal.onExit(null,null),this.endNode.currHitTerminal=null))}setData(t){this._data=t,this.end&&this.end.call("data",this.end,t)}canConnect(t){let i=this.start?this.start:this.end;return!!t&&(i!==t&&(i.node!==t.node&&(i.type!==t.type&&(!!this.flow.rules[i.dataType].includes(t.dataType)&&!!this.flow.executionGraph.canConnect(i.node,t.node)))))}render(){this.flow.flowConnect.context.save(),this._render(),this.flow.flowConnect.context.restore(),this.flow.flowConnect.offContext.save(),this._offRender(),this.flow.flowConnect.offContext.restore()}_render(){let t,i,e,o;this.start?this.startNode.renderState.nodeState===h.NodeState.MAXIMIZED?[t,i]=[this.start.position.x,this.start.position.y]:[t,i]=[this.startNode.position.x+this.startNode.width+this.startNode.style.terminalStripMargin+this.start.style.radius,this.startNode.position.y+this.startNode.style.titleHeight/2]:[t,i]=[this.floatingTip.x,this.floatingTip.y],this.end?this.endNode.renderState.nodeState===h.NodeState.MAXIMIZED?[e,o]=[this.end.position.x,this.end.position.y]:[e,o]=[this.endNode.position.x-this.endNode.style.terminalStripMargin-this.end.style.radius,this.endNode.position.y+this.endNode.style.titleHeight/2]:[e,o]=[this.floatingTip.x,this.floatingTip.y];let n=s.Vector2.Distance(t,i,e,o);n*=.2;let[r,l]=[t+n,i],[a,u]=[e-n,o],[d,p]=[(r+a)/2,(l+u)/2],c=this.flow.flowConnect.context;c.beginPath(),c.moveTo(t,i),c.quadraticCurveTo(r,l,d,p),c.moveTo(d,p),c.quadraticCurveTo(a,u,e,o),c.strokeStyle="grey",c.lineWidth=this.style.width+2,c.stroke(),c.beginPath(),c.moveTo(t,i),c.quadraticCurveTo(r,l,d,p),c.moveTo(d,p),c.quadraticCurveTo(a,u,e,o),c.strokeStyle=this.style.color,c.lineWidth=this.style.width,c.stroke()}_offRender(){}serialize(){return{id:this.id,startId:this.start.id,endId:this.end.id,startNodeId:this.startNode.id,endNodeId:this.endNode.id,style:this.style}}static deSerialize(t,i,e,s){return new r(t,i,e,null,s.style,s.id,!0)}}i.Connector=r;let l=()=>({width:5,color:"#7fff00aa"})},6894:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FlowState=i.Flow=void 0;const s=e(7055),o=e(7417),n=e(6166),h=e(4907),r=e(1141),l=e(587),a=e(8915),u=e(974),d=e(1571),p=e(6645);class c extends o.Hooks{constructor(t,i,e,s,n=(0,u.getNewUUID)()){super(),this.flowConnect=t,this.name=i,this.rules=e,this.terminalTypeColors=s,this.id=n,this.globalEvents=new o.Hooks,this.parentFlow=null,this.listeners={},this.nodes={},this.groups=[],this.connectors={},this.hitColorToNode={},this.hitColorToGroup={},this.sortedNodes=new r.AVLTree(((t,i)=>t.zIndex-i.zIndex),(t=>t.id)),this.inputs=[],this.outputs=[],this.executionGraph=new d.Graph,this.registerListeners(),this.flowConnect.on("tick",(()=>{this.state===f.Running&&this.call("tick",this)}))}get state(){return this.executionGraph.state}registerListeners(){let t=this.flowConnect.on("transform",(()=>this.call("transform",this)));this.listeners.transform=t}deregisterListeners(){this.flowConnect.off("transform",this.listeners.transform),delete this.listeners.transform}existsInFlow(t){for(let i of Object.values(this.nodes)){if(i.subFlow===t)return!0;if(i.subFlow)return i.subFlow.existsInFlow(t)}return!1}addInput(t,i,e){let s=new a.TunnelNode(this,"Input",e,100,[],[{name:t,dataType:i}]);return s.on("process",(()=>{s.outputs[0].setData(s.proxyTerminal.getData())})),this.inputs.push(s),this.nodes[s.id]=s,this.sortedNodes.add(s),this.executionGraph.add(s),this.call("add-input",this,s),s}addOutput(t,i,e){let s=new a.TunnelNode(this,"Output",e,100,[{name:t,dataType:i}],[]);return this.outputs.push(s),this.nodes[s.id]=s,this.sortedNodes.add(s),this.executionGraph.add(s),this.call("add-output",this,s),s}addSubFlow(t,i){if(t.parentFlow)return p.Log.error("Flow is already a sub-flow, a sub-flow cannot have multiple parent flows"),null;let e=new l.SubFlowNode(this,t,i,150,t.inputs.map((t=>({name:t.outputs[0].name,dataType:t.outputs[0].dataType}))),t.outputs.map((t=>({name:t.inputs[0].name,dataType:t.inputs[0].dataType}))),{name:t.name});return this.nodes[e.id]=e,this.sortedNodes.add(e),this.executionGraph.add(e),t.parentFlow=this,e}createNode(t,i,e,o){let n=[],h=[];return void 0!==(o=o?{...g(),...o}:g()).inputs&&(n=o.inputs),void 0!==o.outputs&&(h=o.outputs),new s.Node(this,t,i,e,n,h,{style:o.style,terminalStyle:o.terminalStyle,props:o.props})}removeNode(t){}removeConnector(t){this.connectors[t]===this.flowConnect.floatingConnector&&(this.flowConnect.floatingConnector=null),delete this.connectors[t]}removeAllFocus(){Object.values(this.nodes).forEach((t=>t.focused=!1))}render(){this.groups.forEach((t=>t.render())),Object.values(this.connectors).forEach((t=>t.render())),this.sortedNodes.forEach((t=>t.render()))}start(){this.state===f.Stopped&&(this.executionGraph.start(),this.call("start",this))}stop(){if(this.state!==f.Stopped){for(let t=this.executionGraph.nodes.length-1;t>=0;t-=1)this.executionGraph.nodes[t].filter((t=>t.flowNode instanceof l.SubFlowNode)).map((t=>t.flowNode)).forEach((t=>t.subFlow.stop()));this.executionGraph.stop(),this.call("stop",this)}}serialize(){return{id:this.id,name:this.name,rules:this.rules,terminalTypeColors:this.terminalTypeColors,nodes:Object.values(this.nodes).map((t=>t.serialize())),groups:this.groups.map((t=>t.serialize())),connectors:Object.values(this.connectors).map((t=>t.serialize())),inputs:this.inputs.map((t=>t.serialize())),outputs:this.outputs.map((t=>t.serialize())),executionGraph:this.executionGraph.serialize()}}static deSerialize(t,i){let e=new c(t,i.name,i.rules,i.terminalTypeColors,i.id);return i.nodes.forEach((t=>{let i;i=t.subFlow?l.SubFlowNode.deSerialize(e,t):s.Node.deSerialize(e,t),e.nodes[i.id]=i,e.sortedNodes.add(i)})),i.groups.forEach((t=>{let i=n.Group.deSerialize(e,t);e.groups.push(i),i.nodes.forEach((t=>t.group=i))})),i.inputs.forEach((t=>{let i=a.TunnelNode.deSerialize(e,t);e.inputs.push(i),e.nodes[i.id]=i,e.sortedNodes.add(i)})),i.outputs.forEach((t=>{let i=a.TunnelNode.deSerialize(e,t);e.outputs.push(i),e.nodes[i.id]=i,e.sortedNodes.add(i)})),i.connectors.forEach((t=>{let i=e.nodes[t.startNodeId],s=i.outputs.concat(i.outputsUI).find((i=>i.id===t.startId)),o=e.nodes[t.endNodeId],n=o.inputs.concat(o.inputsUI).find((i=>i.id===t.endId)),r=h.Connector.deSerialize(e,s,n,t);e.connectors[t.id]=r})),e.executionGraph=d.Graph.deSerialize(e,i.executionGraph),e}}var f;i.Flow=c,function(t){t[t.Running=0]="Running",t[t.Idle=1]="Idle",t[t.Stopped=2]="Stopped"}(f=i.FlowState||(i.FlowState={}));let g=()=>({style:{},terminalStyle:{}})},1571:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GraphNode=i.Graph=void 0;const s=e(6645),o=e(974),n=e(6894),h=e(7055),r=e(8240);class l{constructor(){this.state=n.FlowState.Stopped,this.nodes=[],this.nodeToGraphNode={},this.dirtyNodes={}}add(t){this.nodes[0]||this.nodes.push([]);let i=new a(t);this.nodes[0].push(i),this.nodeToGraphNode[t.id]=i}connect(t,i){let e=this.nodeToGraphNode[t.id],s=this.nodeToGraphNode[i.id];e.childs.includes(s)||(e.childs.push(s),s.order<=e.order&&this.updateOrder(s,e.order+1))}disconnect(t,i){let e=this.nodeToGraphNode[t.id],s=this.nodeToGraphNode[i.id],o=new Set;if(t.outputs.forEach((t=>t.connectors.forEach((t=>t.endNode&&o.add(t.endNode))))),o.has(i))return;e.childs.splice(e.childs.indexOf(s),1);let n=i.inputs.filter((t=>t.connectors.length>0)).map((t=>this.nodeToGraphNode[t.connectors[0].startNode.id].order)).reduce(((t,i)=>Math.max(t,i)),0);this.updateOrder(s,n)}updateOrder(t,i){this._updateOrder(t,i);let e=[];for(e.push(t);0!==e.length;){let t=e.shift();t.childs.forEach((i=>{i.order<=t.order&&(this._updateOrder(i,t.order+1),e.includes(i)||e.push(i))}))}}_updateOrder(t,i){this.nodes[t.order].splice(this.nodes[t.order].indexOf(t),1),this.nodes[i]||(this.nodes[i]=[]),t.order=i,this.nodes[i].push(t)}canConnect(t,i){return!this.nodeToGraphNode[i.id].childs.includes(this.nodeToGraphNode[t.id])}async start(){if(this.state===n.FlowState.Stopped){if(this.state=n.FlowState.Running,this.nodes[0])try{for(await this.runAll(this.nodes[0]);0!==Object.values(this.dirtyNodes).length;)await this.runAll(this.lowestDirty(Object.values(this.dirtyNodes)))}catch(t){return s.Log.error("Error while executing graph",t),void(this.state=n.FlowState.Stopped)}}else if(this.state===n.FlowState.Idle){this.state=n.FlowState.Running;try{for(;0!==Object.values(this.dirtyNodes).length;)await this.runAll(this.lowestDirty(Object.values(this.dirtyNodes)))}catch(t){return s.Log.error("Error while executing graph",t),void(this.state=n.FlowState.Stopped)}}this.state=n.FlowState.Idle}stop(){this.state=n.FlowState.Stopped}async runAll(t){await Promise.all(t.map((t=>new Promise((i=>{t.flowNode.run(),this.clearDirty(t),i()})))))}setDirty(t){let i=t instanceof h.Node?this.nodeToGraphNode[t.id]:t;i&&(this.dirtyNodes[i.id]=i)}clearDirty(t){let i=t instanceof h.Node?this.nodeToGraphNode[t.id]:t;delete this.dirtyNodes[i.id]}lowestDirty(t){let i=Math.min(...t.map((t=>t.order)));return t.filter((t=>t.order===i))}propagate(t,i){let e=t instanceof h.Node?this.nodeToGraphNode[t.id]:t,s=new r.List;for(s.append(e);0!==s.length;){let t=s.removeFirst();i(t.flowNode),t.childs.forEach((t=>s.append(t)))}}debugNode(t,i){console.log(`${i}[${t.flowNode.name}, ${t.order}]`),t.childs.forEach((t=>this.debugNode(t,i+"  ")))}debugGraph(){this.nodes[0].forEach((t=>{this.debugNode(t,"")}))}serialize(){let t={};return Object.keys(this.nodeToGraphNode).forEach((i=>t[i]=this.nodeToGraphNode[i].id)),{nodes:this.nodes.map((t=>t.map((t=>t.serialize())))),nodeToGraphNode:t}}static deSerialize(t,i){let e=new l,s={},o={};return i.nodes.forEach(((i,n)=>{e.nodes[n]=i.map((i=>{let e=a.deSerialize(t.nodes[i.nodeId],i);return o[e.id]=e,s[e.id]=i,e}))})),Object.keys(o).forEach((t=>{o[t].childs=s[t].childs.map((t=>o[t]))})),Object.keys(i.nodeToGraphNode).forEach((t=>{e.nodeToGraphNode[t]=o[i.nodeToGraphNode[t]]})),e}}i.Graph=l;class a{constructor(t,i,e){this.flowNode=t,this.childs=[],this.order=i||0,this.id=e||(0,o.getNewUUID)()}serialize(){return{id:this.id,nodeId:this.flowNode.id,order:this.order,childs:this.childs.map((t=>t.id))}}static deSerialize(t,i){return new a(t,i.order,i.id)}}i.GraphNode=a},6166:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Group=void 0;const s=e(7892),o=e(974),n=e(1278),h=e(7417),r=e(712);class l extends h.Hooks{constructor(t,i,e=d()){if(super(),this.flow=t,this.nodes=[],this.nodeDeltas=[],this.renderState=r.ViewPort.INSIDE,this.width=(0,o.get)(e.width,0),this.height=(0,o.get)(e.height,0),this.style=(0,o.get)(e.style,{}),this.id=(0,o.get)(e.id,(0,o.getNewUUID)()),this.hitColor=e.hitColor,this.style={...u(),...e.style},this.id=(0,o.getNewUUID)(),this._position=i,!this.style.color||!this.style.borderColor){let t=a.Random();this.style.borderColor=t[0],this.style.color=t[1]}this.name=e.name,this.setHitColor(e.hitColor),this.computeTextMetrics(),this.flow.on("transform",(()=>this.updateRenderState()))}get name(){return this._name}set name(t){t&&""!==t.trim()?this._name=t:this._name="No Name",this.computeTextMetrics()}get position(){return this._position}set position(t){this._position=t,this.updateRenderState(),this.recomputeNodePositions()}setHitColor(t){if(!t)for(t=n.Color.Random();this.flow.hitColorToGroup[t.rgbaString];)t=n.Color.Random();this.hitColor=t,this.flow.hitColorToGroup[this.hitColor.rgbaString]=this}computeTextMetrics(){let t=this.flow.flowConnect.context;t.font=this.style.fontSize+" "+this.style.font;let i=t.measureText(this.name);if(this.textWidth=i.width,i=t.measureText("M"),t.font=null,this.textHeight=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent,void 0===this.textHeight){let t=document.createElement("span");t.textContent="M",t.style.font=this.style.fontSize+" "+this.style.font,document.body.appendChild(t),this.textHeight=t.offsetHeight,document.body.removeChild(t)}}updateRenderState(){let t=this.position.transform(this.flow.flowConnect.transform);this.renderState=(0,o.intersects)(0,0,this.flow.flowConnect.canvasDimensions.width,this.flow.flowConnect.canvasDimensions.height,t.x,t.y,t.x+this.width*this.flow.flowConnect.scale,t.y+this.height*this.flow.flowConnect.scale)}setContainedNodes(){let t=this.position.transform(this.flow.flowConnect.transform);this.nodes=Object.keys(this.flow.nodes).map((t=>this.flow.nodes[t])).filter((t=>!t.group&&t.renderState.viewport===r.ViewPort.INSIDE)).filter((i=>{let e=i.position.transform(this.flow.flowConnect.transform);return(0,o.intersects)(t.x,t.y,t.x+this.width*this.flow.flowConnect.scale,t.y+this.height*this.flow.flowConnect.scale,e.x,e.y,e.x+i.width*this.flow.flowConnect.scale,e.y+i.ui.height*this.flow.flowConnect.scale)===r.ViewPort.INSIDE})),this.nodes.forEach(((t,i)=>{t.group=this,this.nodeDeltas[i]=t.position.subtract(this.position)}))}recomputeNodePositions(){this.nodes.forEach(((t,i)=>{t.position=this.position.add(this.nodeDeltas[i])}))}render(){this.renderState!==r.ViewPort.OUTSIDE&&(this.flow.flowConnect.context.save(),this._render(),this.flow.flowConnect.context.restore(),this.flow.flowConnect.offGroupContext.save(),this._offRender(),this.flow.flowConnect.offGroupContext.restore())}_render(){let t=this.flow.flowConnect.context;t.strokeStyle=this.style.borderColor,t.lineWidth=2,t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle=this.style.titleColor,t.textBaseline="bottom",t.font=this.style.fontSize+" "+this.style.font,t.fillText(this.name,this.position.x,this.position.y-10)}_offRender(){this.flow.flowConnect.offGroupContext.fillStyle=this.hitColor.rgbaCSSString,this.flow.flowConnect.offGroupContext.fillRect(this.position.x,this.position.y,this.width,this.height),this.flow.flowConnect.offGroupContext.fillRect(this.position.x,this.position.y-this.textHeight-10,this.textWidth,this.textHeight+10)}onClick(t,i){this.call("click",this,t,i);let e=this.position.transform(this.flow.flowConnect.transform);t.y<e.y&&this.flow.flowConnect.showGenericInput(e.subtract(0,(10+this.textHeight)*this.flow.flowConnect.scale),this.name,{width:Math.max(this.textWidth,50)*this.flow.flowConnect.scale+"px",height:this.textHeight*this.flow.flowConnect.scale+"px",fontSize:parseInt(this.style.fontSize.replace("px",""))*this.flow.flowConnect.scale+"px",fontFamily:this.style.font},{type:"text"},(t=>{this.name=t}))}serialize(){return{id:this.id,hitColor:this.hitColor.serialize(),position:this.position.serialize(),name:this.name,width:this.width,height:this.height,style:this.style,nodes:this.nodes.map((t=>t.id)),nodeDeltas:this.nodeDeltas.map((t=>t.serialize()))}}static deSerialize(t,i){let e=new l(t,s.Vector2.deSerialize(i.position),{width:i.width,height:i.height,name:i.name,style:i.style,id:i.id,hitColor:n.Color.deSerialize(i.hitColor)});return i.nodes.forEach((i=>{e.nodes.push(t.nodes[i])})),i.nodeDeltas.forEach((t=>{e.nodeDeltas.push(s.Vector2.deSerialize(t))})),e}}i.Group=l;let a={colors:[["rgba(239, 134, 119, 1)","rgba(239, 134, 119, .5)"],["rgba(160, 231, 125, 1)","rgba(160, 231, 125, .5)"],["rgba(130, 182, 217, 1)","rgba(130, 182, 217, .5)"]],RED:()=>a.colors[0],GREEN:()=>a.colors[1],BLUE:()=>a.colors[2],Random:()=>a.colors[Math.floor(Math.random()*a.colors.length)]},u=()=>({titleColor:"#000",fontSize:"16px",font:"arial"}),d=()=>({width:0,height:0,style:{},id:(0,o.getNewUUID)()})},7417:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Hooks=void 0;i.Hooks=class{constructor(){this.registeredEvents={},this.lastId=0}on(t,i){this.registeredEvents[t]||(this.registeredEvents[t]={});let e=this.lastId;return this.registeredEvents[t][e]=i,this.lastId+=1,e}call(t,...i){this.registeredEvents[t]&&(i||(i=[]),Object.values(this.registeredEvents[t]).forEach((t=>t(...i))))}off(t,i){this.registeredEvents[t]&&delete this.registeredEvents[t][i]}offAll(){this.registeredEvents={}}}},6676:function(t,i,e){var s=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),o=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||s(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),o(e(1278),i),o(e(4907),i),o(e(6894),i),o(e(1571),i),o(e(6166),i),o(e(7417),i),o(e(7055),i),o(e(587),i),o(e(7900),i),o(e(8915),i),o(e(7892),i)},7055:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NodeButton=i.NodeState=i.Node=void 0;const s=e(7892),o=e(712),n=e(8637),h=e(974),r=e(1278),l=e(6894),a=e(7900),u=e(7417),d=e(6645),p=e(1087),c=e(9440),f=e(6518),g=e(5162),y=e(510);class m extends u.Hooks{constructor(t,i,e,s,r,l,a=b()){super(),this.flow=t,this.name=i,this.nodeButtons=[],this.propObservers={},this.renderState={viewport:o.ViewPort.INSIDE,nodeState:C.MAXIMIZED,lod:o.LOD.LOD2},this.focused=!1,this.inputs=[],this.outputs=[],this.inputsUI=[],this.outputsUI=[],this.group=null,this.style=(0,h.get)(a.style,{}),this.terminalStyle=(0,h.get)(a.terminalStyle,{}),this.id=(0,h.get)(a.id,(0,h.getNewUUID)()),a.props=(0,h.get)(a.props,{}),this.hitColor=a.hitColor,this._width=s,this.style={...w(),...a.style},this._position=e,this.setupProps(a.props),this.hitColorToUI={},this.hitColorToTerminal={},this.hitColorToNodeButton={},this._zIndex=0,this.setHitColor(a.hitColor),this.setupTerminals(a,r,l),a.ui?this.ui=a.ui instanceof n.Container?a.ui:n.Container.deSerialize(this,a.ui):this.ui=new n.Container(this,s),this.addNodeButton((()=>this.toggleNodeState()),((t,i)=>{this.context.fillStyle=this.style.maximizeButtonColor,this.context.fillRect(i.x,i.y,this.style.nodeButtonSize,this.style.nodeButtonSize)}),o.Align.Left),this.reflow(),this.ui.update(),this.flow.on("transform",(()=>this.updateRenderState())),this.flow.nodes[this.id]=this,this.flow.sortedNodes.add(this),this.flow.executionGraph.add(this)}get context(){return this.flow.flowConnect.context}get offContext(){return this.flow.flowConnect.offContext}get offUIContext(){return this.flow.flowConnect.offUIContext}get position(){return this._position}set position(t){this._position=t,this.reflow(),this.ui.update(),this.updateRenderState()}get zIndex(){return this._zIndex}set zIndex(t){this.flow.sortedNodes.remove(this)?(this._zIndex=t,this.flow.sortedNodes.add(this)):this._zIndex=t}get width(){return this._width}set width(t){this._width=t,this.ui.width=t,this.ui.update()}setupTerminals(t,i,e){this.inputs.push(...i.map((i=>new a.Terminal(this,a.TerminalType.IN,i.dataType,i.name,i.style?i.style:{...t.terminalStyle},i.id?i.id:null,i.hitColor?r.Color.deSerialize(i.hitColor):null)))),this.outputs.push(...e.map((i=>new a.Terminal(this,a.TerminalType.OUT,i.dataType,i.name,i.style?i.style:{...t.terminalStyle},i.id?i.id:null,i.hitColor?r.Color.deSerialize(i.hitColor):null))))}setupProps(t){this.props=new Proxy({},{set:(t,i,e)=>{void 0===t[i]&&(this.propObservers[i]=[]);let s=t[i];return t[i]=e,this.propObservers[i].forEach((t=>t(s,e))),!0}}),Object.keys(t).forEach((i=>{this.props[i]=t[i]}))}watch(t,i){void 0!==this.props[t]?this.propObservers[t].push(i):d.Log.error(`Cannot watch prop '${t}', prop not found`)}unwatch(t,i){void 0!==this.props[t]?this.propObservers[t].splice(this.propObservers[t].indexOf(i),1):d.Log.error(`Cannot unwatch prop '${t}', prop not found`)}setHitColor(t){if(!t)for(t=r.Color.Random();this.flow.hitColorToNode[t.rgbaString];)t=r.Color.Random();this.hitColor=t,this.flow.hitColorToNode[this.hitColor.rgbaString]=this}addNodeButton(t,i,e){let s,n=new x(this,t,i,e),h=this.nodeButtons.filter((t=>t.align===n.align)).length;return s=e===o.Align.Left?h*(this.style.nodeButtonSize+this.style.nodeButtonSpacing):this.width-h*(this.style.nodeButtonSize+this.style.nodeButtonSpacing)-this.style.nodeButtonSize,n.deltaX=s,this.nodeButtons.push(n),n}reflow(){let t=this.position.y+this.style.terminalRowHeight/2+this.style.padding/2+this.style.titleHeight;this.inputs.length>this.outputs.length?(this.recalculateInputTerminals(t),t=this.position.y+this.inputs.length*this.style.terminalRowHeight/2-this.outputs.length*this.style.terminalRowHeight/2+this.style.terminalRowHeight/2+this.style.padding/2+this.style.titleHeight,this.recalculateOutputTerminals(t)):(this.recalculateOutputTerminals(t),t=this.position.y+this.outputs.length*this.style.terminalRowHeight/2-this.inputs.length*this.style.terminalRowHeight/2+this.style.terminalRowHeight/2+this.style.padding/2+this.style.titleHeight,this.recalculateInputTerminals(t))}updateRenderState(){let t=this.position.transform(this.flow.flowConnect.transform);this.renderState.viewport=(0,h.intersects)(0,0,this.flow.flowConnect.canvasDimensions.width,this.flow.flowConnect.canvasDimensions.height,t.x,t.y,t.x+this.width*this.flow.flowConnect.scale,t.y+(this.renderState.nodeState===C.MAXIMIZED?this.ui.height:this.style.titleHeight)*this.flow.flowConnect.scale),this.flow.flowConnect.scale>.6?this.renderState.lod=o.LOD.LOD2:this.flow.flowConnect.scale<=.6&&this.flow.flowConnect.scale>.3?this.renderState.lod=o.LOD.LOD1:this.renderState.lod=o.LOD.LOD0,this.renderState.viewport===o.ViewPort.INTERSECT&&this.ui.updateRenderState()}recalculateInputTerminals(t){this.inputs.forEach((i=>{i.position.x=this.position.x-this.style.terminalStripMargin-i.style.radius,i.position.y=t,t+=this.style.terminalRowHeight}))}recalculateOutputTerminals(t){this.outputs.forEach((i=>{i.position.x=this.position.x+this.ui.width+this.style.terminalStripMargin+i.style.radius,i.position.y=t,t+=this.style.terminalRowHeight}))}getHitTerminal(t,i,e){let s=null;e=e.transform(this.flow.flowConnect.transform);let o=this.position.transform(this.flow.flowConnect.transform);return(this.inputs.length+this.inputsUI.length>0&&e.x<o.x||this.outputs.length+this.outputsUI.length>0&&e.x>o.x+this.ui.width*this.flow.flowConnect.scale)&&(s=this.hitColorToTerminal[t]),this.currHitTerminal&&this.currHitTerminal!==s&&(this.currHitTerminal.onExit(i,e),s&&s.onEnter(i,e)),s}getHitUINode(t){let i=this.hitColorToUI[t];return i instanceof n.Container?null:i}getHitNodeButton(t){return this.hitColorToNodeButton[t]}run(){this.flow.state!==l.FlowState.Stopped&&this.call("process",this,this.inputs.map((t=>t.connectors.length>0?t.connectors[0].data:null)))}_render(){let t=this.context;if(this.renderState.nodeState===C.MAXIMIZED)this.renderState.lod>0&&(this.inputs.forEach((t=>t.render())),this.outputs.forEach((t=>t.render())));else{if(t.fillStyle="green",this.inputs.length+this.inputsUI.length>0){let i=this.inputs.length>0?this.inputs[0].style.radius:this.inputsUI[0].style.radius;t.fillRect(this.position.x-this.style.terminalStripMargin-2*i,this.position.y+this.style.titleHeight/2-i,2*i,2*i)}if(this.outputs.length+this.outputsUI.length>0){let i=this.outputs.length>0?this.outputs[0].style.radius:this.outputsUI[0].style.radius;t.fillRect(this.position.x+this.width+this.style.terminalStripMargin,this.position.y+this.style.titleHeight/2-i,2*i,2*i)}}if(t.fillStyle=this.style.titleColor,t.font=this.style.titleFontSize+" "+this.style.titleFont,t.textBaseline="middle",t.fillText(this.name,this.position.x+this.ui.width/2-t.measureText(this.name).width/2,this.position.y+this.style.titleHeight/2),this.renderState.nodeState===C.MAXIMIZED&&(t.fillStyle=this.style.color,t.font=this.style.fontSize+" "+this.style.font,t.textBaseline="middle",this.inputs.forEach((i=>{t.fillText(i.name,i.position.x+i.style.radius+this.style.terminalStripMargin+this.style.padding,i.position.y)})),this.outputs.forEach((i=>{t.fillText(i.name,i.position.x-i.style.radius-this.style.terminalStripMargin-this.style.padding-t.measureText(i.name).width,i.position.y)}))),this.focused){let i,e;t.strokeStyle="#000",t.lineWidth=2,i=0===this.inputs.length?0===this.inputsUI.length?0:2*this.inputsUI[0].style.radius:2*this.inputs[0].style.radius,i+=2*this.style.terminalStripMargin,e=0===this.outputs.length?0===this.outputsUI.length?0:2*this.outputsUI[0].style.radius:2*this.outputs[0].style.radius,e+=2*this.style.terminalStripMargin,t.strokeRoundRect(this.position.x-i,this.position.y,this.width+i+e,this.renderState.nodeState===C.MAXIMIZED?this.ui.height+this.style.padding:this.style.titleHeight,4)}}_offRender(){this.offContext.fillStyle=this.hitColor.rgbaCSSString;let t=this.position.x,i=this.position.y,e=0,s=0;if(this.inputs.length+this.inputsUI.length!==0){let i=this.inputs.length>0?this.inputs[0].style.radius:this.inputsUI[0].style.radius;t-=this.style.terminalStripMargin+2*i,e=2*i+this.style.terminalStripMargin}if(this.outputs.length+this.outputsUI.length!==0){s=2*(this.outputs.length>0?this.outputs[0].style.radius:this.outputsUI[0].style.radius)+this.style.terminalStripMargin}this.offContext.fillRect(t,i,this.ui.width+e+s,this.renderState.nodeState===C.MAXIMIZED?this.ui.height:this.style.titleHeight)}addTerminal(t){t instanceof a.Terminal||(t=a.Terminal.deSerialize(this,t)),t.type===a.TerminalType.IN?this.inputs.push(t):this.outputs.push(t),this.ui.update(),this.reflow()}removeTerminal(t){let i=t.type,e=i===a.TerminalType.IN?this.inputs.indexOf(t):this.outputs.indexOf(t);e<0?d.Log.error("Cannot remove terminal, terminal not found"):(t.disconnect(),i===a.TerminalType.IN?this.inputs.splice(e,1):this.outputs.splice(e,1),t.offAll(),this.ui.update(),this.reflow())}getInput(t){if("string"==typeof t){let i=this.inputs.find((i=>i.name===t));if(i)return i.getData()}else if(this.inputs[t])return this.inputs[t].getData();return null}getInputs(){return this.inputs.map((t=>t.getData()))}setOutputs(t,i){if("string"==typeof t){let e=this.outputs.find((i=>i.name===t));e&&e.setData(i)}else if("number"==typeof t)this.outputs[t]&&this.outputs[t].setData(i);else{let i=new Map;Object.entries(t).forEach((t=>{let e=this.outputs.find((i=>i.name===t[0]));if(!e)throw d.Log.error("Terminal '"+t[0]+"' not found");i.set(e,t[1])}));let e=new Map,s=i.keys(),o=s.next().value;for(;o;)o.connectors.forEach((t=>{e.has(t.endNode)?e.get(t.endNode).push(t):e.set(t.endNode,[t])})),o=s.next().value;let n=e.values(),h=n.next().value;for(;h;){for(let t=1;t<h.length;t++)h[t].setData(i.get(h[t].start));h[0].data=i.get(h[0].start),h=n.next().value}}this.flow.state===l.FlowState.Idle&&this.flow.executionGraph.start()}toggleNodeState(){this.renderState.nodeState=this.renderState.nodeState===C.MAXIMIZED?C.MINIMIZED:C.MAXIMIZED}dispose(){this.flow.removeNode(this.id)}render(){this.renderState.viewport!==o.ViewPort.OUTSIDE&&(this.renderState.nodeState===C.MAXIMIZED&&this.ui.render(),this.context.save(),this._render(),this.context.restore(),this.nodeButtons.forEach((t=>t.render())),this.offContext.save(),this._offRender(),this.offContext.restore())}onDown(t,i){this.call("down",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data);this.currHitUINode=this.getHitUINode(e),this.currHitUINode&&this.currHitUINode.onDown(t,i);let s=this.getHitTerminal(e,t,i);s&&(this.currHitTerminal=s,this.currHitTerminal.onDown(t,i))}onOver(t,i){this.call("over",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data),s=this.getHitTerminal(e,t,i);s!==this.prevHitTerminal?(this.prevHitTerminal&&this.prevHitTerminal.onExit(t,i),s&&s.onEnter(t,i)):s&&!this.currHitTerminal&&s.onOver(t,i),this.prevHitTerminal=s;let o=this.getHitUINode(e);o!==this.prevHitUINode?(this.prevHitUINode&&this.prevHitUINode.onExit(t,i),o&&o.onEnter(t,i)):o&&!this.currHitUINode&&o.onOver(t,i),this.prevHitUINode=o}onEnter(t,i){this.call("enter",this,t,i)}onExit(t,i){this.call("exit",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data),s=this.getHitTerminal(e,t,i);s&&s.onExit(t,i),this.prevHitTerminal&&this.prevHitTerminal.onExit(t,i),this.prevHitTerminal=null,this.currHitTerminal&&this.currHitTerminal.onExit(t,i)}onUp(t,i){this.call("up",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data);this.currHitUINode=null;let s=this.getHitUINode(e);s&&s.onUp(t.clone(),i.clone());let o=this.getHitTerminal(e,t,i);o&&o.onUp(t,i)}onClick(t,i){this.call("click",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data);if(i.y<this.position.y+this.style.titleHeight*this.flow.flowConnect.scale){let t=this.getHitNodeButton(e);t&&t.callback()}else{this.currHitTerminal&&this.currHitTerminal.onClick(t,i);let s=this.getHitUINode(e);s&&s.onClick(t.clone(),i.clone())}}onDrag(t,i){this.call("drag",this,t,i);let e=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(t.x,t.y,1,1).data),s=this.getHitUINode(e);this.currHitUINode&&this.currHitUINode.draggable&&(s===this.currHitUINode?this.currHitUINode.onDrag(t,i):(this.currHitUINode.onExit(t,i),this.currHitUINode=null,this.flow.flowConnect.currHitNode=null,this.flow.flowConnect.pointers=[]))}onContextMenu(){this.call("rightclick",this)}onWheel(t,i,e){this.call("wheel",this,t,i,e);let s=r.Color.rgbaToString(this.flow.flowConnect.offUIContext.getImageData(i.x,i.y,1,1).data),o=this.getHitUINode(s);o&&o.zoomable&&o.onWheel(t,i,e)}createLabel(t,i){return new n.Label(this,t,i)}createImage(t,i){return new n.Image(this,t,i)}createSlider(t,i,e){return new n.Slider(this,t,i,e)}createSlider2D(t){return new g.Slider2D(this,t)}createVSlider(t,i,e){return new y.VSlider(this,t,i,e)}createDial(t,i,e,s){return new p.Dial(this,t,i,e,s)}createHozLayout(t=[],i){return new n.HorizontalLayout(this,t,i)}createStack(t){return new n.Stack(this,t)}createButton(t,i){return new n.Button(this,t,i)}createToggle(t){return new n.Toggle(this,t)}createRadioGroup(t,i,e){return new f.RadioGroup(this,t,i,e)}createSelect(t,i){return new n.Select(this,t,i)}createSource(t){return new n.Source(this,t)}createDisplay(t,i,e){return new n.Display(this,t,i,e)}createInput(t){return new n.Input(this,t)}createEnvelope(t,i,e){return new c.Envelope(this,t,i,e)}serialize(){return{id:this.id,name:this.name,position:this.position.serialize(),width:this.width,props:this.props,inputs:this.inputs.map((t=>t.serialize())),outputs:this.outputs.map((t=>t.serialize())),style:this.style,terminalStyle:this.terminalStyle,hitColor:this.hitColor.serialize(),zIndex:this.zIndex,focused:this.focused,renderState:this.renderState,ui:this.ui.serialize()}}static deSerialize(t,i){return new m(t,i.name,s.Vector2.deSerialize(i.position),i.width,i.inputs,i.outputs,{style:i.style,terminalStyle:i.terminalStyle,props:i.props,id:i.id,hitColor:r.Color.deSerialize(i.hitColor),ui:i.ui})}}i.Node=m;let w=()=>({font:"arial",fontSize:".75rem",titleFont:"arial",titleFontSize:".85rem",color:"#000",titleColor:"#000",maximizeButtonColor:"darkgrey",nodeButtonSize:10,nodeButtonSpacing:5,expandButtonColor:"#000",padding:10,spacing:10,rowHeight:20,titleHeight:29,terminalRowHeight:24,terminalStripMargin:8});var C;!function(t){t[t.MAXIMIZED=0]="MAXIMIZED",t[t.MINIMIZED=1]="MINIMIZED"}(C=i.NodeState||(i.NodeState={}));class x{constructor(t,i,e,s){this.node=t,this.callback=i,this._render=e,this.align=s,this.deltaX=0,this.setHitColor()}setHitColor(){let t=r.Color.Random();for(;this.node.hitColorToNodeButton[t.rgbaString];)t=r.Color.Random();this.hitColor=t,this.node.hitColorToNodeButton[this.hitColor.rgbaString]=this}render(){this.node.context.save(),this._render(this,this.node.position.add(this.deltaX,this.node.style.titleHeight/2-this.node.style.nodeButtonSize/2)),this.node.context.restore(),this.node.offUIContext.save(),this._offUIRender(),this.node.offUIContext.restore()}_offUIRender(){this.node.offUIContext.fillStyle=this.hitColor.rgbaCSSString,this.node.offUIContext.fillRect(this.node.position.x+this.deltaX,this.node.position.y+this.node.style.titleHeight/2-this.node.style.nodeButtonSize/2,this.node.style.nodeButtonSize,this.node.style.nodeButtonSize)}}i.NodeButton=x;let b=()=>({style:{},terminalStyle:{},props:{},id:(0,h.getNewUUID)()})},587:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SubFlowNode=void 0;const s=e(7892),o=e(1278),n=e(6894),h=e(7055),r=e(7900),l=e(712);class a extends h.Node{constructor(t,i,e,s,o,n,h=u()){super(t,h.name||"New SubFlow",e,s,o||[],n||[],{style:h.style,terminalStyle:h.terminalStyle,props:h.props,id:h.id,hitColor:h.hitColor}),this.subFlow=i,this.subFlow.on("add-input",((t,i)=>{let e=new r.Terminal(this,r.TerminalType.IN,i.outputs[0].dataType,i.outputs[0].name);i.proxyTerminal=e,this.addTerminal(e)})),this.subFlow.on("add-output",((t,i)=>{let e=new r.Terminal(this,r.TerminalType.OUT,i.inputs[0].dataType,i.inputs[0].name);i.proxyTerminal=e,this.addTerminal(e)})),this.subFlow.inputs.forEach(((t,i)=>t.proxyTerminal=this.inputs[i])),this.subFlow.outputs.forEach(((t,i)=>t.proxyTerminal=this.outputs[i])),this.addNodeButton((()=>{this.flow.flowConnect.render(this.subFlow)}),((t,i)=>{let e=this.context;e.strokeStyle=this.style.expandButtonColor,e.beginPath(),e.moveTo(i.x,i.y+this.style.nodeButtonSize/2),e.lineTo(i.x,i.y+this.style.nodeButtonSize),e.lineTo(i.x+this.style.nodeButtonSize,i.y),e.lineTo(i.x+this.style.nodeButtonSize,i.y+this.style.nodeButtonSize/2),e.moveTo(i.x+this.style.nodeButtonSize,i.y),e.lineTo(i.x+this.style.nodeButtonSize/2,i.y),e.moveTo(i.x,i.y+this.style.nodeButtonSize),e.lineTo(i.x+this.style.nodeButtonSize/2,i.y+this.style.nodeButtonSize),e.closePath(),e.stroke()}),l.Align.Right)}run(){this.flow.state!==n.FlowState.Stopped&&this.subFlow.start()}serialize(){return{id:this.id,name:this.name,position:this.position.serialize(),width:this.width,props:this.props,inputs:this.inputs.map((t=>t.serialize())),outputs:this.outputs.map((t=>t.serialize())),style:this.style,terminalStyle:this.terminalStyle,hitColor:this.hitColor.serialize(),zIndex:this.zIndex,focused:this.focused,renderState:this.renderState,ui:this.ui.serialize(),subFlow:this.subFlow.serialize()}}static deSerialize(t,i){let e=n.Flow.deSerialize(t.flowConnect,i.subFlow);return new a(t,e,s.Vector2.deSerialize(i.position),i.width,i.inputs,i.outputs,{name:i.name,style:i.style,terminalStyle:i.terminalStyle,props:i.props,id:i.id,hitColor:o.Color.deSerialize(i.hitColor)})}}i.SubFlowNode=a;let u=()=>({style:{},terminalStyle:{},props:{}})},7900:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TerminalType=i.Terminal=void 0;const s=e(7892),o=e(974),n=e(1278),h=e(4907),r=e(7417),l=e(6645),a=e(3612);class u extends r.Hooks{constructor(t,i,e,n,h={},r,l){super(),this.node=t,this.type=i,this.dataType=e,this.name=n,this.style=h,this.id=r,this.hitColor=l,this.style={...p(),...h},this.id=r||(0,o.getNewUUID)(),this.setHitColor(l),this.connectors=[],this.position=s.Vector2.Zero(),this.focus=!1}getData(){if(this.type!==d.OUT)return this.connectors.length>0?this.connectors[0].data:null;l.Log.error("Cannot call 'getData' on output terminal")}setData(t){this.type!==d.IN?this.connectors.forEach((i=>i.data=t)):l.Log.error("Cannot call 'setData' on input terminal")}setHitColor(t){if(!t)for(t=n.Color.Random();this.node.hitColorToTerminal[t.rgbaString]||this.node.hitColorToUI[t.rgbaString];)t=n.Color.Random();this.hitColor=t,this.node.hitColorToTerminal[this.hitColor.rgbaString]=this}render(){let t=this.node.context;t.save(),this.focus&&(t.beginPath(),t.arc(this.position.x,this.position.y,3*this.style.radius,0,a.Constant.TAU),t.fillStyle=this.style.focusColor,t.fill()),"event"===this.dataType?(t.beginPath(),t.moveTo(this.position.x,this.position.y-1.3*this.style.radius),t.lineTo(this.position.x+1.3*this.style.radius,this.position.y),t.lineTo(this.position.x,this.position.y+1.3*this.style.radius),t.lineTo(this.position.x-1.3*this.style.radius,this.position.y),t.lineTo(this.position.x,this.position.y-1.3*this.style.radius),t.closePath()):(t.beginPath(),t.arc(this.position.x,this.position.y,this.style.radius,0,a.Constant.TAU)),t.fillStyle=this.focus?"#00ff00":this.node.flow.terminalTypeColors[this.dataType]||"#888",t.strokeStyle=this.style.borderColor,t.shadowBlur=this.style.shadowBlur,t.shadowColor=this.style.shadowColor,t.fill(),t.stroke(),t.restore(),this.offUIRender()}connect(t,i){if(this.type!==t.type){let i=this.type===d.OUT?this:t,e=this.type===d.IN?this:t;if(e.connectors.length>0&&i.connectors.includes(e.connectors[0]))return!1}if((0,o.canConnect)(this,t,this.node.flow.rules,this.node.flow.executionGraph)){let e=new h.Connector(this.node.flow,this.type===d.OUT?this:t,this.type===d.IN?this:t,null,i);return this.node.flow.connectors[e.id]=e,!0}return!1}disconnect(t){if(this.type===d.IN)return this._disconnect(this.connectors[0]),!0;if("string"==typeof t){let i=this.connectors.find((i=>i.id===t));if(!i)return l.Log.error("Connector not found while disconnecting",t),!1;this._disconnect(i)}else if(t instanceof h.Connector){if(!this.connectors.find((i=>i.id===t.id)))return l.Log.error("Connector cannot be disconnected from the terminal because its not associated with it",t),!1;this._disconnect(t)}else this.connectors.forEach((t=>this._disconnect(t)));return!0}_disconnect(t){let[i,e]=[t.start,t.end];delete this.node.flow.connectors[t.id],t.start.connectors.splice(t.start.connectors.findIndex((i=>i.id===t.id)),1),t.end.connectors.pop(),this.node.flow.executionGraph.disconnect(i.node,e.node),t.start.onDisconnect(t,i,e),t.end.onDisconnect(t,i,e)}offUIRender(){let t=this.node.offUIContext;t.save(),t.beginPath(),t.arc(this.position.x,this.position.y,this.style.radius+this.node.style.terminalStripMargin,0,a.Constant.TAU),t.fillStyle=this.hitColor.rgbaCSSString,t.fill(),t.restore()}isConnected(){return this.connectors.length>0}onEnter(t,i){this.call("enter",this,t,i),this.focus=!0,this.node.flow.flowConnect.cursor="pointer"}onExit(t,i){this.call("exit",this,t,i),this.focus=!1,this.node.flow.flowConnect.cursor="unset"}onDown(t,i){if(this.call("down",this,t,i),this.connectors.length>0)if(this.type===d.IN){let[t,e]=[this.connectors[0].start,this.connectors[0].end];this.connectors[0].endNode.currHitTerminal=null,this.connectors[0].end=null,this.connectors[0].endNode=null,this.connectors[0].floatingTip=i,this.node.flow.flowConnect.floatingConnector=this.connectors[0];let s=this.connectors.pop();this.node.flow.executionGraph.disconnect(t.node,e.node),s.start.onDisconnect(s,t,e),this.onDisconnect(s,t,e)}else{if(this.node.flow.flowConnect.floatingConnector)return;let t=new h.Connector(this.node.flow,this,null,i,{});this.node.flow.connectors[t.id]=t,this.node.flow.flowConnect.floatingConnector=t}else{if(this.node.flow.flowConnect.floatingConnector)return;let t=new h.Connector(this.node.flow,this.type===d.IN?null:this,this.type===d.IN?this:null,i,{});this.node.flow.connectors[t.id]=t,this.node.flow.flowConnect.floatingConnector=t}}onUp(t,i){this.call("up",this,t,i)}onDrag(t,i){this.call("drag",this,t,i)}onClick(t,i){this.call("click",this,t,i)}onOver(t,i){this.call("over",this,t,i)}onContextMenu(){this.call("rightclick",this)}onConnect(t){this.call("connect",this,t)}onDisconnect(t,i,e){this.call("disconnect",this,t,i,e)}onEvent(t){this.type===d.IN&&this.call("event",this,t)}emit(t){this.type===d.OUT&&0!==this.connectors.length&&this.connectors.forEach((i=>{i.end&&i.end.onEvent(t)}))}serialize(){return{id:this.id,type:this.type,dataType:this.dataType,name:this.name,style:this.style,hitColor:this.hitColor.serialize()}}static deSerialize(t,i){return new u(t,i.type,i.dataType,i.name,i.style,i.id,n.Color.deSerialize(i.hitColor))}}var d;i.Terminal=u,function(t){t[t.IN=1]="IN",t[t.OUT=2]="OUT"}(d=i.TerminalType||(i.TerminalType={}));let p=()=>({radius:4,borderColor:"#222",shadowBlur:0,shadowColor:"#ccc",focusColor:"#bbbbbb80"})},8915:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TunnelNode=void 0;const s=e(7892),o=e(1278),n=e(7055);class h extends n.Node{constructor(t,i,e,s,o,n,h=r()){super(t,i,e,s,o,n,{style:h.style,terminalStyle:h.terminalStyle,props:h.props,id:h.id,hitColor:h.hitColor}),this.inputs.length>0?this.inputs[0].on("data",((t,i)=>this.proxyTerminal.setData(i))):this.outputs[0].on("connect",((t,i)=>{this.proxyTerminal.connectors.length>0&&(i.data=this.proxyTerminal.connectors[0].data)}))}get proxyTerminal(){return this._proxyTerminal}set proxyTerminal(t){this._proxyTerminal=t,this._proxyTerminal.on("data",((t,i)=>this.outputs[0].setData(i)))}serialize(){return{id:this.id,name:this.name,position:this.position.serialize(),width:this.width,props:this.props,inputs:this.inputs.map((t=>t.serialize())),outputs:this.outputs.map((t=>t.serialize())),style:this.style,terminalStyle:this.terminalStyle,hitColor:this.hitColor.serialize(),zIndex:this.zIndex,focused:this.focused,renderState:this.renderState,ui:this.ui.serialize(),proxyTerminalId:this.proxyTerminal.id}}static deSerialize(t,i){return new h(t,i.name,s.Vector2.deSerialize(i.position),i.width,i.inputs,i.outputs,{style:i.style,terminalStyle:i.terminalStyle,props:i.props,id:i.id,hitColor:o.Color.deSerialize(i.hitColor)})}}i.TunnelNode=h;let r=()=>({style:{},terminalStyle:{},props:{}})},7892:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Vector2=void 0;const s=e(974);class o{constructor(t,i){t instanceof DOMPoint?[this.x,this.y]=[t.x,t.y]:[this.x,this.y]=[t||0,i||0]}addInPlace(t,i){return t instanceof o?(this.x+=t.x,this.y+=t.y):void 0===i?(this.x+=t,this.y+=t):(this.x+=t,this.y+=i),this}multiplyInPlace(t,i){return t instanceof o?(this.x*=t.x,this.y*=t.y):void 0===i?(this.x*=t,this.y*=t):(this.x*=t,this.y*=i),this}subtractInPlace(t,i){return t instanceof o?(this.x-=t.x,this.y-=t.y):void 0===i?(this.x-=t,this.y-=t):(this.x-=t,this.y-=i),this}normalizeInPlace(t,i,e,o){return void 0!==e&&void 0!==o?(this.x=(0,s.normalize)(this.x,t,i),this.y=(0,s.normalize)(this.y,e,o)):(this.x=(0,s.normalize)(this.x,t,i),this.y=(0,s.normalize)(this.y,t,i)),this}clampInPlace(t,i,e,o){return void 0!==e&&void 0!==o?(this.x=(0,s.clamp)(this.x,t,i),this.y=(0,s.clamp)(this.y,e,o)):(this.x=(0,s.clamp)(this.x,t,i),this.y=(0,s.clamp)(this.y,t,i)),this}transformInPlace(t){let i=t.transformPoint(this);return[this.x,this.y]=[i.x,i.y],this}absInPlace(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}add(t,i){return new o(this.x,this.y).addInPlace(t,i)}multiply(t,i){return new o(this.x,this.y).multiplyInPlace(t,i)}subtract(t,i){return new o(this.x,this.y).subtractInPlace(t,i)}normalize(t,i,e,s){return new o(this.x,this.y).normalizeInPlace(t,i,e,s)}clamp(t,i,e,s){return new o(this.x,this.y).clampInPlace(t,i,e,s)}isInside(t,i,e,s){if(t instanceof o&&i instanceof o){if(this.x<t.x||this.x>i.x)return!1;if(this.y<t.y||this.y>i.y)return!1}else{if(this.x<t||this.x>e)return!1;if(this.y<i||this.y>s)return!1}return!0}assign(t,i){return t instanceof o?(this.x=t.x,this.y=t.y):void 0===i?(this.x=t,this.y=t):(this.x=t,this.y=i),this}transform(t){return new o(this.x,this.y).transformInPlace(t)}abs(){return new o(this.x,this.y).absInPlace()}toString(){return"["+this.x.toFixed(3)+", "+this.y.toFixed(3)+"]"}clone(){return new o(this.x,this.y)}max(){return Math.max(this.x,this.y)}isEqual(t,i){return void 0!==i?o.Distance(this,t)<=i:this.x===t.x&&this.y===t.y}static Distance(t,i,e,s){return t instanceof o&&i instanceof o?Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)):"number"==typeof t&&"number"==typeof i?Math.sqrt(Math.pow(e-t,2)+Math.pow(s-i,2)):void 0}static Midpoint(t,i){return new o((t.x+i.x)/2,(t.y+i.y)/2)}static Zero(){return new o(0,0)}static Random(t,i,e,s){return new o(Math.random()*(i-t)+t,Math.random()*(s-e)+e)}serialize(){return{x:this.x,y:this.y}}static deSerialize(t){return new o(t.x,t.y)}}i.Vector2=o},6184:function(t,i,e){var s=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),o=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||s(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),i.Constant=i.FlowConnectState=i.FlowConnect=void 0;const n=e(6676),h=e(7892),r=e(974),l=e(6645),a=e(7900),u=e(6894),d=e(712),p=e(3511);class c extends n.Hooks{constructor(t){super(),this.audioBufferCache=new Map,this.arrayBufferCache=new Map,this.canvasDimensions={top:0,left:0,width:0,height:0},this.state=f.Stopped,this.flows=[],this.pointers=[],this.keymap={},this.touchControls={CreateGroup:!1},this.genericInput=document.createElement("input"),this.minScale=.1,this.maxScale=5,this.wheelScaleDelta=1.05,this.pinchScaleDelta=1.02,this.disableScale=!1,this._transform=new DOMMatrix,this.inverseTransform=new DOMMatrix,this.identity=new DOMMatrix,this.startTime=-1,this.prepareCanvas(t),this.setupHitCanvas(),this.calculateCanvasDimension(!0),this.registerChangeListeners(),this.attachStyles(),this.polyfill(),this.registerEvents(),this.setGenericInput()}static async create(t){let i=new c(t);return await i.setupAudioContext(),i}get context(){return this._context}get audioContext(){return this._audioContext}get offContext(){return this._offContext}get offUIContext(){return this._offUIContext}get offGroupContext(){return this._offGroupContext}get cursor(){return this.canvas.style.cursor}set cursor(t){this.canvas.style.cursor=t}get scale(){return this._transform.a}get transform(){return this._transform}get time(){return this.startTime<0?this.startTime:performance.now()-this.startTime}registerChangeListeners(){let t=!1;document.addEventListener("scroll",(()=>{t||(window.requestAnimationFrame((()=>{this.calculateCanvasDimension(!1),t=!1})),t=!0)})),this.registerObservers(this.canvas.parentElement)}registerObservers(t){this.parentResizeObserver&&this.parentResizeObserver.disconnect(),this.bodyResizeObserver&&this.bodyResizeObserver.disconnect(),this.parentResizeObserver=new ResizeObserver((()=>{this.calculateCanvasDimension(!0),this.updateTransform(null,null,null)})),this.parentResizeObserver.observe(t),t!==document.body&&(this.bodyResizeObserver=new ResizeObserver((()=>{this.calculateCanvasDimension(!0),this.updateTransform(null,null,null)})),this.bodyResizeObserver.observe(document.body))}prepareCanvas(t){t?t instanceof HTMLDivElement?(this.canvas=document.createElement("canvas"),this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,t.appendChild(this.canvas)):t instanceof HTMLCanvasElement?this.canvas=t:l.Log.error("mount provided is not of type HTMLDivElement or HTMLCanvasElement"):(this.canvas=document.createElement("canvas"),this.canvas.width=document.body.clientWidth,this.canvas.height=document.body.clientHeight,document.body.appendChild(this.canvas)),Object.assign(this.canvas.style,{position:"absolute",width:"100%",height:"100%"}),this._context=this.canvas.getContext("2d")}setupHitCanvas(){"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof OffscreenCanvasRenderingContext2D?(this.offCanvas=new OffscreenCanvas(this.canvasDimensions.width,this.canvasDimensions.height),this.offUICanvas=new OffscreenCanvas(this.canvasDimensions.width,this.canvasDimensions.height),this.offGroupCanvas=new OffscreenCanvas(this.canvasDimensions.width,this.canvasDimensions.height)):(this.offCanvas=document.createElement("canvas"),this.offUICanvas=document.createElement("canvas"),this.offGroupCanvas=document.createElement("canvas")),this._offContext=this.offCanvas.getContext("2d"),this._offUIContext=this.offUICanvas.getContext("2d"),this._offGroupContext=this.offGroupCanvas.getContext("2d")}attachStyles(){this.canvas.style.touchAction="none";let t=document.createElement("style");t.innerHTML="input.flow-connect-input { position: fixed; visibility: hidden; pointer-events: none; z-index: 100; border: none; border-radius: 0; box-sizing: border-box;} input.flow-connect-input:focus { outline: none; }",document.getElementsByTagName("head")[0].appendChild(t)}calculateCanvasDimension(t){if(t){let t=this.canvas.parentElement.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,this.call("dimension-change",this,this.canvas.width,this.canvas.height)}let i=this.canvas.getBoundingClientRect();this.canvasDimensions={top:Math.round(i.top),left:Math.round(i.left),width:Math.round(i.width),height:Math.round(i.height)},this.offCanvas.width=this.canvasDimensions.width,this.offCanvas.height=this.canvasDimensions.height,this.offUICanvas.width=this.canvasDimensions.width,this.offUICanvas.height=this.canvasDimensions.height,this.offGroupCanvas.width=this.canvasDimensions.width,this.offGroupCanvas.height=this.canvasDimensions.height}polyfill(){CanvasRenderingContext2D.prototype.roundRect=function(t,i,e,s,o){this.beginPath(),this.moveTo(t+o,i),this.lineTo(t+e-o,i),this.quadraticCurveTo(t+e,i,t+e,i+o),this.lineTo(t+e,i+s-o),this.quadraticCurveTo(t+e,i+s,t+e-o,i+s),this.lineTo(t+o,i+s),this.quadraticCurveTo(t,i+s,t,i+s-o),this.lineTo(t,i+o),this.quadraticCurveTo(t,i,t+o,i),this.closePath()},CanvasRenderingContext2D.prototype.strokeRoundRect=function(t,i,e,s,o){void 0===o&&(o=5),this.roundRect(t,i,e,s,o),this.stroke()},CanvasRenderingContext2D.prototype.fillRoundRect=function(t,i,e,s,o){void 0===o&&(o=5),this.roundRect(t,i,e,s,o),this.fill()}}registerEvents(){let t,i=h.Vector2.Zero(),e=-1;window.onkeydown=t=>{!this.keymap[t.key]&&(this.keymap[t.key]=!0)},window.onkeyup=t=>{this.keymap[t.key]=!1},this.canvas.onpointerdown=e=>{this.currFlow&&(this.addPointer(e.pointerId,this.getRelativePosition(e)),1===this.pointers.length?(i=this.pointers[0].screenPosition,this.currHitNode=this.getHitNode(this.pointers[0].screenPosition),this.currHitNode?(this.currHitNode.zIndex=Number.MAX_SAFE_INTEGER,this.keymap.Control?this.currHitNode.focused=!this.currHitNode.focused:(this.currFlow.removeAllFocus(),this.currHitNode.focused=!0),this.currHitNode.onDown(this.pointers[0].screenPosition.clone(),this.pointers[0].realPosition.clone()),t=this.currHitNode.position.subtract(this.pointers[0].realPosition)):this.keymap.Control?(this.keymap.Control||this.touchControls.CreateGroup)&&(this.groupStartPoint=this.pointers[0].realPosition.clone(),this.currGroup=new n.Group(this.currFlow,this.groupStartPoint.clone(),{name:"New Group"})):(this.currFlow.removeAllFocus(),this.currHitGroup=this.getHitGroup(this.pointers[0].screenPosition),this.currHitGroup&&(t=this.currHitGroup.position.subtract(this.pointers[0].realPosition)))):(this.currHitNode=null,this.currHitGroup=null,this.currFlow.removeAllFocus(),this.floatingConnector&&this.fallbackConnection()))},this.canvas.onpointerup=t=>{if(!this.currFlow)return;this.removePointer(this.pointers,t),this.pointers.length<2&&(e=-1);let i=this.getRelativePosition(t),s=i.transform(this.inverseTransform);this.currHitNode&&this.handleGrouping(i),this.currHitNode=null,this.currHitGroup=null;let o=this.getHitNode(i);if(o&&o.onUp(i.clone(),s.clone()),this.currGroup){let t=this.currGroup;this.currGroup=null,t.width>10&&t.height>10&&(this.currFlow.groups.push(t),t.setContainedNodes())}this.floatingConnector&&this.handleConnection(o,i,s)},this.canvas.onpointerout=t=>{if(this.currFlow){if(this.removePointer(this.pointers,t),0===this.pointers.length){if(this.currHitNode){let i=this.getRelativePosition(t);this.handleGrouping(i)}this.currHitNode=null,this.currHitGroup=null}if(this.currGroup){let t=this.currGroup;this.currGroup=null,t.width>10&&t.height>10&&(this.currFlow.groups.push(t),t.setContainedNodes())}if(this.floatingConnector&&this.fallbackConnection(),this.prevHitNode){let i=this.getRelativePosition(t),e=i.transform(this.inverseTransform);this.prevHitNode.onExit(i,e),this.prevHitNode=null}}},this.canvas.onpointermove=s=>{if(!this.currFlow)return;let o=this.getRelativePosition(s),n=o.transform(this.inverseTransform);if(this.updatePointer(s.pointerId,o,n),2===this.pointers.length){let t=h.Vector2.Distance(this.pointers[0].screenPosition,this.pointers[1].screenPosition);e>0&&t!==e&&this.handleZoom(t>e,h.Vector2.Midpoint(this.pointers[0].screenPosition,this.pointers[1].screenPosition),this.pinchScaleDelta),e=t}if(this.currGroup&&(n.x<this.groupStartPoint.x&&(this.currGroup.position.x=n.x),this.currGroup.width=Math.abs(this.groupStartPoint.x-n.x),n.y<this.groupStartPoint.y&&(this.currGroup.position.y=n.y),this.currGroup.height=Math.abs(this.groupStartPoint.y-n.y)),this.currHitNode){if(this.currHitNode.onDrag(o.clone(),n.clone()),this.currHitNode&&!(this.currHitNode.currHitUINode&&this.currHitNode.currHitUINode.draggable||this.currHitNode.currHitTerminal||this.floatingConnector)){this.currHitNode.position=n.add(t);let i=this.getHitGroup(o);if(i&&i===this.currHitNode.group){let t=i.position.transform(this._transform),e=this.currHitNode.position.transform(this._transform);if((0,r.intersects)(t.x,t.y,t.x+i.width*this.scale,t.y+i.height*this.scale,e.x,e.y,e.x+this.currHitNode.width*this.scale,e.y+this.currHitNode.ui.height*this.scale)===d.ViewPort.INSIDE){let t=i.nodes.findIndex((t=>t.id===this.currHitNode.id));i.nodeDeltas[t]=this.currHitNode.position.subtract(i.position)}}}}else if(this.currHitGroup)this.currHitGroup.position=n.add(t);else if(1===this.pointers.length&&!this.keymap.Control&&!this.touchControls.CreateGroup){let t=o.subtract(i).multiplyInPlace(1/this.scale);i=o,this.updateTransform(null,null,t)}if(this.floatingConnector&&(this.floatingConnector.floatingTip=n),"mouse"===s.pointerType&&!this.currHitNode){let t=this.getHitNode(o);t!==this.prevHitNode?(this.prevHitNode&&this.prevHitNode.onExit(o,n),t&&t.onEnter(o,n)):t&&!this.currHitNode&&t.onOver(o,n),this.prevHitNode=t}},this.canvas.onclick=t=>{if(!this.currFlow)return;let i=this.getRelativePosition(t),e=i.transform(this.inverseTransform),s=this.getHitNode(i);if(s&&s.onClick(i.clone(),e.clone()),!s){let t=this.getHitGroup(i);t&&t.onClick(i.clone(),e.clone())}},this.canvas.oncontextmenu=t=>{if(!this.currFlow)return;t.preventDefault();let i=this.getRelativePosition(t),e=this.getHitNode(i);e&&e.onContextMenu(),this.keymap.Control||this.currFlow.removeAllFocus(),e&&(e.focused=!0)},this.canvas.onwheel=t=>{if(!this.currFlow)return;let i=this.getRelativePosition(t),e=this.getHitNode(i);if(e){let s=n.Color.rgbaToString(this.offUIContext.getImageData(i.x,i.y,1,1).data),o=e.getHitUINode(s);if(o&&o.zoomable)return void e.onWheel(t.deltaY<0,i,i.transform(this.inverseTransform))}this.disableScale||(t.preventDefault(),this.handleZoom(t.deltaY<0,i,this.wheelScaleDelta))}}setGenericInput(){this.genericInput.className="flow-connect-input",this.genericInput.style.visibility="hidden",this.genericInput.style.pointerEvents="none",this.genericInput.style.padding="0",this.genericInput.onblur=()=>{this.genericInput.style.visibility="hidden",this.genericInput.style.pointerEvents="none",this.genericInput.onchange=null},document.body.appendChild(this.genericInput)}async setupAudioContext(){window.__FLOWCONNECT_AUDIO_CTX__?this._audioContext=window.__FLOWCONNECT_AUDIO_CTX__:(this._audioContext=new AudioContext,window.__FLOWCONNECT_AUDIO_CTX__=this._audioContext);let t=(0,p.generateAudioWorklets)(p.WorkletUtils.CircularBuffer);return await this.audioContext.audioWorklet.addModule(p.WorkletUtils.CircularBuffer),Promise.all(Object.keys(t).map((i=>this.audioContext.audioWorklet.addModule(t[i]))))}showGenericInput(t,i,e,s,o){document.activeElement!==this.genericInput&&(Object.assign(this.genericInput.style,e),Object.assign(this.genericInput,s),Object.assign(this.genericInput.style,{left:t.x+this.canvasDimensions.left+"px",top:t.y+this.canvasDimensions.top-3+"px",visibility:"visible",pointerEvents:"all"}),this.genericInput.value=i,this.genericInput.onchange=()=>o(this.genericInput.value),this.genericInput.focus())}changeParent(t){this.registerObservers(t)}updatePointer(t,i,e){let s=this.pointers.find((i=>i.id===t));s&&(s.screenPosition=i,s.realPosition=e)}handleZoom(t,i,e){this._transform.a>=this.maxScale&&t||this._transform.a<=this.minScale&&!t||(this.updateTransform(t?e:1/e,i,null),this.call("scale",this.scale))}handleGrouping(t){let i,e=this.getHitGroup(t);if(e){let t=e.position.transform(this._transform),s=this.currHitNode.position.transform(this._transform);i=(0,r.intersects)(t.x,t.y,t.x+e.width*this.scale,t.y+e.height*this.scale,s.x,s.y,s.x+this.currHitNode.width*this.scale,s.y+this.currHitNode.ui.height*this.scale)}if(this.currHitNode.group)if(this.currHitNode.group!==e){let t=this.currHitNode.group.nodes.findIndex((t=>t.id===this.currHitNode.id));this.currHitNode.group.nodes.splice(t,1),this.currHitNode.group.nodeDeltas.splice(t,1),this.currHitNode.group=null}else if(i!==d.ViewPort.INSIDE){let t=this.currHitNode.group.nodes.findIndex((t=>t.id===this.currHitNode.id));this.currHitNode.group.nodes.splice(t,1),this.currHitNode.group.nodeDeltas.splice(t,1),this.currHitNode.group=null}e&&i===d.ViewPort.INSIDE&&(this.currHitNode.group=e,e.nodes.push(this.currHitNode),e.nodeDeltas.push(this.currHitNode.position.subtract(e.position)))}handleConnection(t,i,e){if(!t)return void this.fallbackConnection();let s=t.getHitTerminal(n.Color.rgbaToString(this._offUIContext.getImageData(i.x,i.y,1,1).data),i.clone(),e.clone());if(s&&(t.currHitTerminal=s),!s)return void this.fallbackConnection();let o=t.currHitTerminal;if(this.floatingConnector.canConnect(o)){if(o.type===a.TerminalType.OUT)this.floatingConnector.completeConnection(o),t.currHitTerminal=null;else if(o.connectors.length>0){if(o.connectors[0].start===this.floatingConnector.start)return this.fallbackConnection(),void(t.currHitTerminal=null);let i=o.connectors[0].start.connectors.indexOf(o.connectors[0]),[e]=o.connectors[0].start.connectors.splice(i,1),[s,n]=[e.start,e.end];delete this.currFlow.connectors[e.id],this.currFlow.executionGraph.disconnect(s.node,n.node),e.start.onDisconnect(e,s,n),e.end.onDisconnect(e,s,n),this.floatingConnector.completeConnection(o),t.currHitTerminal=null}else this.floatingConnector.completeConnection(o),t.currHitTerminal=null;this.floatingConnector=null}else this.fallbackConnection(),t.currHitTerminal=null}getRelativePosition(t){return new h.Vector2(t.clientX-this.canvasDimensions.left,t.clientY-this.canvasDimensions.top)}updateTransform(t,i,e){if(t){let e=i.transform(this.inverseTransform);this._transform.translateSelf(e.x,e.y).scaleSelf(t,t).translateSelf(-e.x,-e.y)}e&&this._transform.translateSelf(e.x,e.y),this.inverseTransform=this._transform.inverse(),this._context.setTransform(this._transform),this._offContext.setTransform(this._transform),this._offUIContext.setTransform(this._transform),this._offGroupContext.setTransform(this._transform),this.call("transform",this)}translateBy(t){this.updateTransform(null,null,t)}scaleBy(t,i){this.updateTransform(t,i)}fallbackConnection(){this.floatingConnector.removeConnection(),this.currFlow.removeConnector(this.floatingConnector.id)}addPointer(t,i){this.pointers.push({id:t,screenPosition:i,realPosition:i.transform(this.inverseTransform)})}removePointer(t,i){t.splice(t.findIndex((t=>t.id===i.pointerId)),1)}getHitNode(t){let i=n.Color.rgbaToString(this._offContext.getImageData(t.x,t.y,1,1).data);return this.currFlow.hitColorToNode[i]}getHitGroup(t){let i=n.Color.rgbaToString(this._offGroupContext.getImageData(t.x,t.y,1,1).data);return this.currFlow.hitColorToGroup[i]}clear(){this._context.save(),this._context.setTransform(this.identity),this._context.clearRect(0,0,this.canvasDimensions.width,this.canvasDimensions.height),this._context.restore(),this._offContext.save(),this._offContext.setTransform(this.identity),this._offContext.clearRect(0,0,this.canvasDimensions.width,this.canvasDimensions.height),this._offContext.restore(),this._offUIContext.save(),this._offUIContext.setTransform(this.identity),this._offUIContext.clearRect(0,0,this.canvasDimensions.width,this.canvasDimensions.height),this._offUIContext.restore(),this._offGroupContext.save(),this._offGroupContext.setTransform(this.identity),this._offGroupContext.clearRect(0,0,this.canvasDimensions.width,this.canvasDimensions.height),this._offGroupContext.restore()}startGlobalTime(){this.startTime<0&&(this.startTime=performance.now(),this._startGlobalTime(),this.state=f.Running,this.call("start",this))}_startGlobalTime(){this.call("tick",this),this.timerId=window.requestAnimationFrame(this._startGlobalTime.bind(this))}stopGlobalTime(){this.isRootFlowStopped()&&(cancelAnimationFrame(this.timerId),this.startTime=-1,this.state=f.Stopped,this.call("tickreset",this),this.call("stop",this))}isRootFlowStopped(){let t=this.currFlow;for(;;){if(!t.parentFlow)return t.state===u.FlowState.Stopped;t=t.parentFlow}}_render(){this.clear(),this.currGroup&&this.currGroup.render(),this.currFlow.render(),this.call("update",this),this.frameId=window.requestAnimationFrame(this._render.bind(this))}createFlow(t={name:"New Flow",rules:{},terminalTypeColors:{}}){t.rules||(t.rules={}),t.terminalTypeColors||(t.terminalTypeColors={}),t.rules={...t.rules,...g()};let i=new n.Flow(this,t.name,t.rules,t.terminalTypeColors);return this.flows.push(i),i.on("start",(()=>this.startGlobalTime())),i.on("stop",(()=>this.stopGlobalTime())),i}render(t){t!==this.currFlow&&(this.currFlow&&(window.cancelAnimationFrame(this.frameId),this.currFlow.deregisterListeners()),this.rootFlow&&this.rootFlow.existsInFlow(t)||(this.rootFlow=t),this.currFlow=t,this._render())}top(){this.render(this.rootFlow)}fromJson(t){let i,e=null;try{i=JSON.parse(t),e=n.Flow.deSerialize(this,i)}catch(t){l.Log.error(t)}return e}toJson(t){let i=t.serialize();try{return JSON.stringify(i,null)}catch(t){l.Log.error(t)}}}var f;i.FlowConnect=c,function(t){t[t.Stopped=0]="Stopped",t[t.Running=1]="Running"}(f=i.FlowConnectState||(i.FlowConnectState={}));let g=()=>({string:["string","any"],number:["number","audioparam","any"],boolean:["boolean","any"],array:["array","any"],file:["file","any"],event:["event","any"],vector2:["vector2","any"],"array-buffer":["array-buffer","any"],audio:["audio","audioparam"],audioparam:["audioparam"],"audio-buffer":["audio-buffer","any"],any:["any"]});o(e(20),i),o(e(6676),i);var y=e(3612);Object.defineProperty(i,"Constant",{enumerable:!0,get:function(){return y.Constant}}),o(e(8637),i),o(e(5928),i)},3511:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.generateAudioWorklets=i.WorkletUtils=void 0,i.WorkletUtils={CircularBuffer:URL.createObjectURL(new Blob(["export default class CircularBuffer {\n      constructor(bufferLength, noOfChannels) {\n        this.noOfChannels = noOfChannels;\n        this.bufferLength = bufferLength;\n\n        this.read = this.write = this.frames = 0;\n        this.channels = [];\n        for (let i = 0; i < this.noOfChannels; ++i) this.channels[i] = new Float32Array(bufferLength);\n      }\n      pushBlock(buffer) {\n        let sourceLength = buffer[0].length;\n        for (let i = 0; i < sourceLength; ++i) {\n          let write = (this.write + i) % this.bufferLength;\n          for (let c = 0; c < this.noOfChannels; ++c) {\n            this.channels[c][write] = buffer[c][i];\n          }\n        }\n        this.write += sourceLength;\n        if (this.write >= this.bufferLength) this.write = 0;\n        this.frames += sourceLength;\n        if (this.frames > this.bufferLength) this.frames = this.bufferLength;\n      }\n      popBlock(buffer) {\n        if (this.frames === 0) return;\n        let destinationLength = buffer[0].length;\n        for (let i = 0; i < destinationLength; ++i) {\n          let read = (this.read + i) % this.bufferLength;\n          for (let c = 0; c < this.noOfChannels; ++c) {\n            buffer[c][i] = this.channels[c][read];\n          }\n        }\n        this.read += destinationLength;\n        if (this.read >= this.bufferLength) this.read = 0;\n        this.frames -= destinationLength;\n        if (this.frames < 0) this.frames = 0;\n      }\n    }"],{type:"application/javascript"}))};i.generateAudioWorklets=t=>({Worklet_ProxyParamForSource:URL.createObjectURL(new Blob(["registerProcessor('proxy-param-for-source', class ProxyParamForSource extends AudioWorkletProcessor {\n          static get parameterDescriptors() {\n            return [{\n              name: 'detune',\n              defaultValue: 0,\n              minValue: -2400,\n              maxValue: 2400,\n              automationRate: 'k-rate'\n            }, {\n              name: 'playbackRate',\n              defaultValue: 1,\n              minValue: 0.25,\n              maxValue: 3,\n              automationRate: 'k-rate'\n            }]\n          }\n          process(inputs, outputs, parameters) {\n            outputs[0].forEach(channel => {\n              for (let i = 0; i < channel.length; i++) {\n                // wierd bug, the detune is off by 1200 cents, have to offset this anomaly\n                channel[i] = (parameters['detune'].length > 1 ? parameters['detune'][i] : parameters['detune'][0]) - 1200;\n              }\n            });\n            outputs[1].forEach(channel => {\n              for (let i = 0; i < channel.length; i++) {\n                channel[i] = (parameters['playbackRate'].length > 1 ? parameters['playbackRate'][i] : parameters['playbackRate'][0]);\n              }\n            });\n            return true;\n          }\n        })"],{type:"application/javascript"})),Worklet_ProxyParam:URL.createObjectURL(new Blob(["registerProcessor('proxy-param', class ProxyParam extends AudioWorkletProcessor {\n          static get parameterDescriptors() {\n            return [{\n              name: 'param',\n              defaultValue: 0,\n              minValue: -340282346638528859811704183484516925439,\n              maxValue: 340282346638528859811704183484516925439,\n              automationRate: 'k-rate'\n            }]\n          }\n\n          min = -340282346638528859811704183484516925439;\n          max =  340282346638528859811704183484516925439;\n          offset = 0;\n          constructor(...args) {\n            super(...args);\n            this.port.onmessage = (e) => {\n              switch(e.data.type) {\n                case 'set-range': {\n                  this.min = e.data.value.min;\n                  this.max = e.data.value.max;\n                  break;\n                }\n                case 'set-offset': {\n                  this.offset = -e.data.value\n                  break;\n                }\n                default: break;\n              }\n            }\n          }\n          clamp(value) { return Math.min(Math.max(value, this.min), this.max); }\n          process(inputs, outputs, parameters) {\n            outputs[0].forEach(channel => {\n              for (let i = 0; i < channel.length; i++) {\n                channel[i] = this.clamp((parameters['param'].length > 1 ? parameters['param'][i] : parameters['param'][0]) + this.offset);\n              }\n            });\n            return true;\n          }\n        })"],{type:"application/javascript"})),Worklet_Debug:URL.createObjectURL(new Blob(["registerProcessor('debug', class Debug extends AudioWorkletProcessor {\n          throttle = 1000;\n          lastPeak = -Infinity;\n          constructor(...args) {\n            super(...args);\n            this.port.onmessage = (e) => {\n              this.throttle = e.data;\n            }\n          }\n          process(inputs, outputs, parameters) {\n            if (Date.now() - this.lastPeak > this.throttle) {\n              let data = {\n                inputs: inputs.map(input => input.length),\n                outputs: outputs.map(output => output.length)\n              };\n              this.port.postMessage(data);\n              this.lastPeak = Date.now();\n            }\n            let input = inputs[0];\n            let output = outputs[0]\n            for (let i = 0 ; i < input.length ; i+=1) {\n              for(let c = 0 ; c < input[i].length ; c+=1) {\n                output[i][c] = input[i][c];\n              }\n            }\n            return true;\n          }\n        })"],{type:"application/javascript"})),Worklet_MoogEffect:URL.createObjectURL(new Blob([`import CircularBuffer from '${t}'\n      registerProcessor('moog-effect', class MoogEffect extends AudioWorkletProcessor {\n      cutoff = 0.065;\n      resonance = 3.5;\n      f = 0; inputFactor = 0; fb = 0;\n\n      constructor(options) {\n        super();\n        this.bufferSize = options.processorOptions.bufferSize;\n\n        this.setParams();\n        this.port.onmessage = (e) => {\n          this.cutoff = e.data.cutoff;\n          this.resonance = e.data.resonance;\n          this.setParams();\n        }\n      }\n      setParams() {\n        this.f = this.cutoff * 1.16;\n        this.inputFactor = 0.35013 * (this.f * this.f) * (this.f * this.f);\n        this.fb = this.resonance * (1.0 - 0.15 * this.f * this.f);\n      }\n      channelsChanged(newNoOfChannels) {\n        this.channelCount = newNoOfChannels;\n        this.inputBuffer = new CircularBuffer(this.bufferSize, this.channelCount);\n        this.outputBuffer = new CircularBuffer(this.bufferSize, this.channelCount);\n        this.in1 = new Array(this.channelCount).fill(0);\n        this.in2 = new Array(this.channelCount).fill(0);\n        this.in3 = new Array(this.channelCount).fill(0);\n        this.in4 = new Array(this.channelCount).fill(0);\n        this.out1 = new Array(this.channelCount).fill(0);\n        this.out2 = new Array(this.channelCount).fill(0);\n        this.out3 = new Array(this.channelCount).fill(0);\n        this.out4 = new Array(this.channelCount).fill(0);\n      }\n\n      _process(input, output) {\n        for (let c = 0; c < input.length; ++c) {\n          for (let i = 0; i < input[c].length; ++i) {\n            input[c][i] -= this.out4[c] * this.fb;\n            input[c][i] *= this.inputFactor;\n            this.out1[c] = input[c][i] + 0.3 * this.in1[c] + (1 - this.f) * this.out1[c];\n            this.in1[c] = input[c][i];\n            this.out2[c] = this.out1[c] + 0.3 * this.in2[c] + (1 - this.f) * this.out2[c];\n            this.in2[c] = this.out1[c];\n            this.out3[c] = this.out2[c] + 0.3 * this.in3[c] + (1 - this.f) * this.out3[c];\n            this.in3[c] = this.out2[c];\n            this.out4[c] = this.out3[c] + 0.3 * this.in4[c] + (1 - this.f) * this.out4[c];\n            this.in4[c] = this.out3[c];\n            output[c][i] = this.out4[c];\n          }\n        }\n      }\n      process(inputs, outputs, parameters) {\n        let input = inputs[0], output = outputs[0];\n        if (input.length === 0) return true;\n\n        if (!this.prevChannelCount || this.prevChannelCount !== inputs[0].length) {\n          this.channelsChanged(inputs[0].length);\n          this.prevChannelCount = inputs[0].length;\n        }\n\n        this.inputBuffer.pushBlock(input);\n        if (this.inputBuffer.frames >= this.bufferSize) {\n          let tmpInBuffer = [], tmpOutBuffer = [];\n          for (let i = 0; i < this.channelCount; ++i) {\n            tmpInBuffer[i] = new Float32Array(this.bufferSize);\n            tmpOutBuffer[i] = new Float32Array(this.bufferSize);\n          }\n\n          this.inputBuffer.popBlock(tmpInBuffer);\n          this._process(tmpInBuffer, tmpOutBuffer);\n          this.outputBuffer.pushBlock(tmpOutBuffer);\n        }\n        this.outputBuffer.popBlock(output);\n        return true;\n      }\n    })`],{type:"application/javascript"})),Worklet_BitcrusherEffect:URL.createObjectURL(new Blob([`import CircularBuffer from '${t}'\n      registerProcessor('bitcrusher-effect', class BitcrusherEffect extends AudioWorkletProcessor {\n      bits = 4;\n      normFreq = 0.1;\n      step = 0;\n\n      constructor(options) {\n        super();\n        this.bufferSize = options.processorOptions.bufferSize;\n\n        this.setParams();\n        this.port.onmessage = (e) => {\n          this.bits = e.data.bits;\n          this.normFreq = e.data.normFreq;\n          this.setParams();\n        }\n      }\n      setParams() {\n        this.step = Math.pow(1 / 2, this.bits);\n      }\n      channelsChanged(newNoOfChannels) {\n        this.channelCount = newNoOfChannels;\n        this.inputBuffer = new CircularBuffer(this.bufferSize, this.channelCount);\n        this.outputBuffer = new CircularBuffer(this.bufferSize, this.channelCount);\n        this.phaser = new Array(this.channelCount).fill(0);\n        this.last = new Array(this.channelCount).fill(0);\n      }\n\n      _process(input, output) {\n        for (let c = 0; c < input.length; ++c) {\n          for (let i = 0; i < input[c].length; ++i) {\n            this.phaser[c] += this.normFreq;\n            if (this.phaser[c] >= 1.0) {\n              this.phaser[c] -= 1.0;\n              this.last[c] = this.step * Math.floor(input[c][i] / this.step + 0.5);\n            }\n            output[c][i] = this.last[c];\n          }\n        }\n      }\n      process(inputs, outputs, parameters) {\n        let input = inputs[0], output = outputs[0];\n        if (input.length === 0) return true;\n        if (!this.prevChannelCount || this.prevChannelCount !== inputs[0].length) {\n          this.channelsChanged(inputs[0].length);\n          this.prevChannelCount = inputs[0].length;\n        }\n        this.inputBuffer.pushBlock(input);\n        if (this.inputBuffer.frames >= this.bufferSize) {\n          let tmpInBuffer = [], tmpOutBuffer = [];\n          for (let i = 0; i < this.channelCount; ++i) {\n            tmpInBuffer[i] = new Float32Array(this.bufferSize);\n            tmpOutBuffer[i] = new Float32Array(this.bufferSize);\n          }\n          this.inputBuffer.popBlock(tmpInBuffer);\n          this._process(tmpInBuffer, tmpOutBuffer);\n          this.outputBuffer.pushBlock(tmpOutBuffer);\n        }\n        this.outputBuffer.popBlock(output);\n        return true;\n      }\n    })`],{type:"application/javascript"})),Worklet_LFO:URL.createObjectURL(new Blob(["registerProcessor('lfo', class LFO extends AudioWorkletProcessor {\n      oscillation = 0.3;\n      offset = 0.85;\n      phaseInc = 0;\n      phase = 0;\n\n      constructor(options) {\n        super();\n        this.sampleRate = options.processorOptions.sampleRate;\n\n        this.port.onmessage = (e) => {\n          switch(e.data.type) {\n            case 'set-oscillation': { this.oscillation = e.data.value; break; }\n            case 'set-offset': { this.offset = e.data.value; break; }\n            case 'set-phase': { this.phase = e.data.value; break; }\n            case 'set-frequency': { this.phaseInc = 2 * Math.PI * e.data.value * 128 / this.sampleRate; break; }\n            case 'set-all': {\n              this.oscillation = e.data.value.oscillation;\n              this.offset = e.data.value.offset;\n              this.phase = e.data.value.phase;\n              this.phaseInc = 2 * Math.PI * e.data.value.frequency * 128 / this.sampleRate;\n              break;\n            }\n            default: return;\n          }\n        }\n      }\n      process(inputs, outputs, parameters) {\n        let output = outputs[0][0];\n\n        for (let i = 0; i < output.length; ++i) {\n          this.phase += this.phaseInc;\n          if (this.phase > 2 * Math.PI) this.phase = 0;\n          output[i] = this.offset + this.oscillation * Math.sin(this.phase);\n        }\n\n        return true;\n      }\n    })"],{type:"application/javascript"})),Worklet_Noise:URL.createObjectURL(new Blob(["registerProcessor('noise', class Noise extends AudioWorkletProcessor {\n      type = 'white';\n      types = ['white', 'pink', 'brownian'];\n\n      constructor(options) {\n        super();\n        this.port.onmessage = (e) => {\n          if (!this.types.includes(e.data)) this.type = 'white';\n          else this.type = e.data;\n        }\n\n        this.generate = {\n          'white': (output) => {\n            for (let i = 0; i < output.length; ++i) output[i] = Math.random() * 2 - 1;\n          },\n          'pink': (output) => {\n            let b0, b1, b2, b3, b4, b5, b6;\n            b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;\n\n            for (let i = 0; i < output.length; ++i) {\n              let white = Math.random() * 2 - 1;\n              b0 = 0.99886 * b0 + white * 0.0555179;\n              b1 = 0.99332 * b1 + white * 0.0750759;\n              b2 = 0.96900 * b2 + white * 0.1538520;\n              b3 = 0.86650 * b3 + white * 0.3104856;\n              b4 = 0.55000 * b4 + white * 0.5329522;\n              b5 = -0.7616 * b5 - white * 0.0168980;\n              output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;\n              output[i] *= 0.11;\n              b6 = white * 0.115926;\n            }\n          },\n          'brownian': (output) => {\n            let lastOut = 0.0;\n            for (let i = 0; i < output.length; i++) {\n              let white = Math.random() * 2 - 1;\n              output[i] = (lastOut + (0.02 * white)) / 1.02;\n              lastOut = output[i];\n              output[i] *= 3.5;\n            }\n          }\n        }\n      }\n      process(inputs, outputs, parameters) {\n        this.generate[this.type](outputs[0][0]);\n        return true;\n      }\n    })"],{type:"application/javascript"})),Worklet_Proxy:URL.createObjectURL(new Blob(["registerProcessor('proxy', class Proxy extends AudioWorkletProcessor {\n\n      constructor() { super(); }\n      process(inputs, outputs, parameters) {\n        inputs.forEach((input, index) => input.forEach((channel, cIndex) => {\n          outputs[index][cIndex].set(channel);\n        }));\n        return true;\n      }\n    })"],{type:"application/javascript"}))})},3612:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Constant=void 0;class e{}i.Constant=e,e.TAU=2*Math.PI,e.SIN_60=.866,e.PHI=1.618033988749895},5124:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.imageIcon=i.fileIcon=void 0,i.fileIcon="data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='iso-8859-1'?%3e%3c!-- --%3e%3csvg version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 477.867 477.867' style='enable-background:new 0 0 477.867 477.867;' xml:space='preserve'%3e%3cg%3e%3cg%3e%3cpath d='M324.267,119.467c-9.426,0-17.067-7.641-17.067-17.067V0H102.4C74.123,0,51.2,22.923,51.2,51.2v375.467 c0,28.277,22.923,51.2,51.2,51.2h273.067c28.277,0,51.2-22.923,51.2-51.2v-307.2H324.267z'/%3e%3c/g%3e%3c/g%3e%3cg%3e%3cg%3e%3cpolygon points='341.333,10.001 341.333,85.333 416.666,85.333 '/%3e%3c/g%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3cg%3e%3c/g%3e%3c/svg%3e",i.imageIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjDAMLKTYM6GTwAAACaElEQVRo3u2ZP2gUQRSHv90zGKMY/IPxBBGSEGKUixGsFFSQnAZEbUQrEXuvCIiIiKWCbbQXLBRsgpVgockhIhYJGg0oJEWwuNOYYJI7E29scufuZndvNjs30+yb5vbd2/l9Ozvv7cyuRdU6ybATPVZknK9Ox2FGEZrbCH1V+dMsapcXCBbJgkWaL2zVNPRem6M7xV1OGpKHZrCYpMsYAExalNhYO8yzpEF0E0drv8u4pkW7lqtud2raWiRDLAEwDrBBOrKFixxnFwXe8JQFdQhyWZBlxhH3nYEYiq4skAMYYMVTx1c4pw+glaLPo+Qn21UAyEzCq+zw8W7jWozbUDMZgFMR/coBdgf407oAZiP6lQPkA/yjKgBksmAfJZ8sKNOxTsXIWTDNLR/vHb6FnJOihzZVIwBwk2VXGbqNFdLn+dW6+ZYD9UZAfkGynyE+UuQTj3y7/W/9Dth5TqgCkLW9FFx9lrigE6CJ/JrpuswVfQBDvluQCtf1AFwO3AVVuNF4gIP8Dt2K3WsswBYm6u4GH2I3CsDiWV15geAJTY0BGJSSFwiG6YkCkJYqqMf4Iw0gGJMDaOEBPxAIZsiFrp7bXAvWqC0AYA/vXf+8C7w9KV7GkA8AyDC9JnCOS74A92PJ+wKcYT4g+DGbPfJnqagGyPE3JHyCjEO+k9mY8h6AroBa7mxL5Fblm/kQW94DMCZ50nMOcYRXCuSFhVh38VFixrfnCUACkAAkAAlAApAA2JSN6pdtpowCTNm8MAowbJHmM62G5H/RDZA19Ol2gf4qSR8j2uVf0ws43vZ10Kvt832B8eprzn/ptwK4iL9QVQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0xMi0wM1QxMTo0MTo1NCswMDowME8knnIAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMTItMDNUMTE6NDE6NTQrMDA6MDA+eSbOAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAABJRU5ErkJggg=="},5162:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Slider2D=void 0;const s=e(7900),o=e(7892),n=e(974),h=e(2681),r=e(1278),l=e(6894),a=e(3612);class u extends h.UINode{constructor(t,i=p(t)){super(t,o.Vector2.Zero(),h.UIType.Slider2D,{draggable:!0,style:i.style?{...d(),...i.style}:d(),propName:i.propName,input:i.input&&("boolean"==typeof i.input?new s.Terminal(t,s.TerminalType.IN,"vector2","",{}):s.Terminal.deSerialize(t,i.input)),output:i.output&&("boolean"==typeof i.output?new s.Terminal(t,s.TerminalType.OUT,"vector2","",{}):s.Terminal.deSerialize(t,i.output)),id:i.id,hitColor:i.hitColor}),this.pointDiameter=20,this.height=(0,n.get)(i.height,4*this.node.style.rowHeight),this._value=this.propName?this.getProp():(0,n.get)(i.value,new o.Vector2(.5,.5)),this._value.clampInPlace(0,1),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),this.node.on("process",(()=>{this.output&&this.output.setData(this.value)})),this.thumbHitColor=r.Color.Random().hexValue,"undefined"!=typeof OffscreenCanvas?this.offThumbCanvas=new OffscreenCanvas(this.width,this.height):(this.offThumbCanvas=document.createElement("canvas"),this.offThumbCanvas.width=this.width,this.offThumbCanvas.height=this.height),this.offThumbContext=this.offThumbCanvas.getContext("2d"),this.renderOffThumb()}get value(){return this.propName?this.getProp():this._value}set value(t){t=t.clamp(0,1);let i=this.value,e=t;this.propName?this.setProp(e):this._value=e,this.renderOffThumb(),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,i,e)}renderOffThumb(){let[t,i]=[this.width-this.pointDiameter,this.height-this.pointDiameter];this.offThumbContext.clearRect(0,0,t,i);let e=new o.Vector2(this.value.x,1-this.value.y).multiply(t,i).add(this.pointDiameter/2);this.offThumbContext.fillStyle=this.thumbHitColor,this.offThumbContext.beginPath(),this.offThumbContext.arc(e.x,e.y,this.pointDiameter/2,0,a.Constant.TAU),this.offThumbContext.fill()}paint(){let t=this.node.context;t.fillStyle=this.style.backgroundColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.fillRect(this.position.x,this.position.y,this.width,this.height),t.strokeRect(this.position.x,this.position.y,this.width,this.height);let[i,e]=[this.width-this.pointDiameter,this.height-this.pointDiameter],s=new o.Vector2(this.value.x,1-this.value.y).multiplyInPlace(i,e).addInPlace(this.position).addInPlace(this.pointDiameter/2);t.fillStyle=this.style.thumbColor,t.beginPath(),t.arc(s.x,s.y,this.pointDiameter/2,0,a.Constant.TAU),t.fill()}paintLOD1(){let t=this.context;t.strokeStyle="#000",t.fillStyle=this.style.backgroundColor,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let[t,i]=[this.width,this.height];Math.floor(this.offThumbCanvas.width)===Math.floor(t)&&Math.floor(this.offThumbCanvas.height)===Math.floor(i)||(this.offThumbCanvas.width=t,this.offThumbCanvas.height=i,this.renderOffThumb()),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}getHitPoint(t){let i=t.subtract(this.position),e=r.Color.rgbaToHex(this.offThumbContext.getImageData(i.x,i.y,1,1).data);return this.thumbHitColor===e}movePoint(t){let[i,e]=[this.width-this.pointDiameter,this.height-this.pointDiameter];this._value=t.clamp(this.position.x+this.pointDiameter/2,this.position.x+this.width-this.pointDiameter/2,this.position.y+this.pointDiameter/2,this.position.y+this.height-this.pointDiameter/2).subtractInPlace(this.position.add(this.pointDiameter/2)).clampInPlace(0,i,0,e).normalizeInPlace(0,i,0,e),this.value=new o.Vector2(this._value.x,1-this._value.y)}onPropChange(t,i){this._value=i,this.renderOffThumb(),this.output&&this.output.setData(this.value)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||(this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,null,this._value),this.isHit=!1,this.call("up",this,t,i))}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||(this.movePoint(i),this.call("drag",this,t,i))}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||(this.isHit&&(this.movePoint(i),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,null,this._value)),this.isHit=!1,this.call("exit",this,t,i))}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{value:this.value.serialize(),propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,{value:o.Vector2.deSerialize(i.value),propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}i.Slider2D=u;let d=()=>({backgroundColor:"#666",thumbColor:"#fff",borderColor:"#000",borderWidth:1}),p=t=>({height:4*t.style.rowHeight})},3283:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Button=void 0;const s=e(7900),o=e(7892),n=e(5120),h=e(2681),r=e(1278),l=e(712),a=e(974);class u extends h.UINode{constructor(t,i,e=p(t)){super(t,o.Vector2.Zero(),h.UIType.Button,{style:e.style?{...d(),...e.style}:d(),input:e.input&&("boolean"==typeof e.input?new s.Terminal(t,s.TerminalType.IN,"event","",{}):new s.Terminal(t,e.input.type,e.input.dataType,e.input.name,e.input.style,e.input.id,r.Color.deSerialize(e.input.hitColor))),output:e.output&&("boolean"==typeof e.output?new s.Terminal(t,s.TerminalType.OUT,"event","",{}):s.Terminal.deSerialize(t,e.output)),id:e.id,hitColor:e.hitColor}),this.text=i,this.input&&this.input.on("event",(()=>this.call("click",this))),this.height=(0,a.get)(e.height,this.node.style.rowHeight+2*this.style.padding),this.label=new n.Label(this.node,i,{style:{fontSize:this.style.fontSize,font:this.style.font,align:l.Align.Center,color:this.style.color},height:this.height}),this.label.on("click",((t,i)=>this.call("click",this,i))),this.children.push(this.label)}paint(){this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(this.position.x,this.position.y,this.width,this.height)}paintLOD1(){this.context.strokeStyle="#000",this.paint(),this.context.strokeRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.label.position=this.position,this.label.height=this.height,this.label.width=this.width,this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled||this.call("rightclick",this)}serialize(){return{text:this.text,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,id:this.id,style:this.style,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,i.text,{input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}i.Button=u;let d=()=>({backgroundColor:"#666",padding:5,color:"#fff",font:"arial",fontSize:"11px",visible:!0}),p=t=>({height:1.5*t.style.rowHeight})},5818:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Container=void 0;const s=e(1278),o=e(7892),n=e(3283),h=e(119),r=e(8104),l=e(8735),a=e(7799),u=e(560),d=e(5120),p=e(4136),c=e(2526),f=e(8002),g=e(6369),y=e(2681),m=e(712);class w extends y.UINode{constructor(t,i,e=x()){super(t,t.position,y.UIType.Container,{style:e.style?{...C(),...e.style}:C(),id:e.id,hitColor:e.hitColor}),this.width=i,this.height=2*this.node.style.padding,this.contentWidth=this.width-2*this.node.style.padding}paint(){let t=this.context;t.shadowColor=this.style.shadowColor,t.shadowBlur=3,t.shadowOffsetX=this.style.shadowOffset.x,t.shadowOffsetY=this.style.shadowOffset.y,t.fillStyle=this.style.backgroundColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.roundRect(this.position.x,this.position.y+this.node.style.titleHeight,this.width,this.height-this.node.style.titleHeight,5),t.stroke(),t.fill()}paintLOD1(){let t=this.context;t.fillStyle=this.style.backgroundColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.roundRect(this.position.x,this.position.y+this.node.style.titleHeight,this.width,this.height-this.node.style.titleHeight,5),t.stroke(),t.fill()}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.position=this.node.position;let t=Math.max(this.node.inputs.length,this.node.outputs.length)*this.node.style.terminalRowHeight+this.node.style.titleHeight,i=this.position.x+this.node.style.padding,e=this.position.y+t;this.children.filter((t=>t.visible)).forEach((t=>{e+=this.node.style.spacing;let s=this.width-2*this.node.style.padding;if(t.width=(t.width>s?s:t.width)||s,t.width<s){let s;s=t.style.align===m.Align.Center?this.position.x+this.width/2-t.width/2:t.style.align===m.Align.Right?this.position.x+this.width-this.node.style.padding-t.width:i,t.position=new o.Vector2(s,e)}else t.position=new o.Vector2(i,e);e+=t.height})),this.height=e+this.node.style.padding-this.position.y}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){}serialize(){return{width:this.width,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,id:this.id,style:{backgroundColor:this.style.backgroundColor,shadowColor:this.style.shadowColor,shadowBlur:this.style.shadowBlur,shadowOffset:this.style.shadowOffset.serialize(),borderWidth:this.style.borderWidth,borderColor:this.style.borderColor},hitColor:this.hitColor.serialize(),type:this.type,childs:this.children.map((t=>t.serialize()))}}static deSerialize(t,i){let e=new w(t,i.width,{style:i.style,id:i.id,hitColor:s.Color.deSerialize(i.hitColor)});return e.children.push(...i.childs.map((i=>{switch(i.type){case y.UIType.Button:return n.Button.deSerialize(t,i);case y.UIType.Container:return w.deSerialize(t,i);case y.UIType.Display:return h.Display.deSerialize(t,i);case y.UIType.HorizontalLayout:return r.HorizontalLayout.deSerialize(t,i);case y.UIType.Stack:return l.Stack.deSerialize(t,i);case y.UIType.Image:return a.Image.deSerialize(t,i);case y.UIType.Input:return u.Input.deSerialize(t,i);case y.UIType.Label:return d.Label.deSerialize(t,i);case y.UIType.Select:return p.Select.deSerialize(t,i);case y.UIType.Slider:return c.Slider.deSerialize(t,i);case y.UIType.Source:return f.Source.deSerialize(t,i);case y.UIType.Toggle:return g.Toggle.deSerialize(t,i);default:return}}))),e}}i.Container=w;let C=()=>({backgroundColor:"#dddddd",shadowColor:"#666",shadowBlur:3,shadowOffset:new o.Vector2(3,3),borderWidth:1,borderColor:"#444",visible:!0}),x=()=>({})},1087:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Dial=void 0;const s=e(7900),o=e(7892),n=e(974),h=e(2681),r=e(1278),l=e(6894),a=e(3612);class u extends h.UINode{constructor(t,i,e,r,l=p(i)){super(t,o.Vector2.Zero(),h.UIType.Dial,{draggable:!0,style:l.style?{...d(r),...l.style}:d(r),propName:l.propName,input:l.input&&("boolean"==typeof l.input?new s.Terminal(t,s.TerminalType.IN,"number","",{}):s.Terminal.deSerialize(t,l.input)),output:l.output&&("boolean"==typeof l.output?new s.Terminal(t,s.TerminalType.OUT,"number","",{}):s.Terminal.deSerialize(t,l.output)),id:l.id,hitColor:l.hitColor}),this.min=i,this.max=e,this.thumbStart=o.Vector2.Zero(),this.thumbEnd=o.Vector2.Zero(),this.height=r,this._value=(0,n.get)(l.value,i),this.temp=(0,n.normalize)(this._value,this.min,this.max),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),this.node.on("process",(()=>{this.output&&this.output.setData(this.value)}))}get value(){return this.propName?this.getProp():this._value}set value(t){let i=this.value,e=(0,n.clamp)(t,this.min,this.max);this.propName?this.setProp(e):this._value=e,this.temp=(0,n.normalize)(e,this.min,this.max),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,i,e)}paint(){let t=this.context,i=Math.min(this.width,this.height);t.fillStyle=this.style.color,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.shadowColor=this.style.shadowColor,t.shadowBlur=this.style.shadowBlur,t.shadowOffsetX=3,t.shadowOffsetY=3,t.beginPath(),t.arc(this.position.x+this.width/2,this.position.y+this.height/2,i/2,0,a.Constant.TAU),t.stroke(),t.fill(),t.lineCap="round",t.lineWidth=10,t.strokeStyle=this.style.thumbColor,t.shadowColor=this.style.thumbShadowColor,t.shadowBlur=this.style.thumbShadowBlur,t.beginPath(),t.moveTo(this.thumbStart.x,this.thumbStart.y),t.lineTo(this.thumbEnd.x,this.thumbEnd.y),t.stroke()}paintLOD1(){let t=this.context;t.strokeStyle="#000",t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){let t=this.offUIContext,i=Math.min(this.width,this.height);t.fillStyle=this.hitColor.hexValue,t.beginPath(),t.arc(this.position.x+this.width/2,this.position.y+this.height/2,i/2,0,a.Constant.TAU),t.fill()}reflow(){let t=this.position.add(this.width/2,this.height/2),i=(0,n.normalize)(this.value,this.min,this.max)*a.Constant.TAU+Math.PI/2,e=Math.min(this.width,this.height);this.thumbStart.assign(t.x+Math.cos(i)*(e/5),t.y+Math.sin(i)*(e/5)),this.thumbEnd.assign(t.x+Math.cos(i)*(e/2-10),t.y+Math.sin(i)*(e/2-10)),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}pointToValue(t){let i=t.subtract(this.position.add(this.width/2,this.height/2)),e=Math.atan2(i.y,i.x);return e<0&&(e+=a.Constant.TAU),(e/a.Constant.TAU-.25+1)%1}onPropChange(t,i){this._value=i,this.temp=(0,n.normalize)(i,this.min,this.max),this.reflow(),this.output&&this.output.setData(this._value)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||(this.lastAngle=void 0,this.deltaValue=this.pointToValue(i),this.temp=(0,n.normalize)(this.value,this.min,this.max),this.onDrag(t,i),this.call("down",this,t,i))}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){if(this.disabled)return;let e=this.pointToValue(i),s=e-this.deltaValue;s=Math.abs(s)>.5?0:s,this.deltaValue=e,this.temp=this.temp+s,this.temp=(0,n.clamp)(this.temp,0,1);let o=this.temp*a.Constant.TAU;o<0&&(o+=a.Constant.TAU),void 0!==this.lastAngle&&Math.abs(this.lastAngle-o)>2&&(o=this.lastAngle>3?a.Constant.TAU:0),this.lastAngle=o;let h=o/a.Constant.TAU;this.value=(0,n.denormalize)((0,n.clamp)(h,0,1),this.min,this.max),this.temp=h,this.reflow(),this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||(this.lastAngle=void 0,this.call("exit",this,t,i))}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{min:this.min,max:this.max,value:this.value,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,size:this.height,id:this.id,hitColor:this.hitColor.serialize(),style:this.style,type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,i.min,i.max,i.size,{value:i.value,propName:i.propName,input:i.input,output:i.output,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}i.Dial=u;let d=t=>({color:"#e3e3e3",borderColor:"#000",borderWidth:1,shadowColor:"grey",shadowBlur:5,thumbColor:"#c9c9c9",thumbShadowColor:"#858585",thumbShadowBlur:5,size:t,visible:!0}),p=t=>({value:t})},119:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasType=i.Display=void 0;const s=e(1278),o=e(7900),n=e(7892),h=e(2681);class r extends h.UINode{constructor(t,i,e,s=u()){super(t,n.Vector2.Zero(),h.UIType.Display,{draggable:!0,zoomable:!0,style:s.style?{...a(),...s.style}:a(),input:s.clear&&"boolean"!=typeof s.clear?o.Terminal.deSerialize(t,s.clear):new o.Terminal(t,o.TerminalType.IN,"event","",{}),id:s.id,hitColor:s.hitColor}),this.offCanvasConfigs=[],this.height=i,"undefined"!=typeof OffscreenCanvas?e.forEach((t=>{let i,e,s;t.canvasType===l.HTMLCanvasElement?(i=document.createElement("canvas"),i.width=this.node.width-2*this.node.style.padding,i.height=this.height):i=new OffscreenCanvas(this.node.width-2*this.node.style.padding,this.height),e=i.getContext("2d"),s={canvas:i,context:e,rendererConfig:t,shouldRender:!0},this.offCanvasConfigs.push(s)})):e.forEach((t=>{let i=document.createElement("canvas");i.width=this.node.width-2*this.node.style.padding,i.height=this.height;let e=i.getContext("2d"),s={canvas:i,context:e,rendererConfig:t,shouldRender:!0};this.offCanvasConfigs.push(s)})),this.input.on("event",(()=>{this.offCanvasConfigs.filter((t=>!t.rendererConfig.auto)).forEach((t=>{t.context.clearRect(0,0,t.canvas.width,t.canvas.height)}))})),this.node.flow.flowConnect.on("scale",(()=>this.reflow()))}customRender(t){return Promise.all(t.map((t=>new Promise((i=>{t.shouldRender?(t.rendererConfig.clear&&t.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.style.backgroundColor&&(t.context.fillStyle=this.style.backgroundColor,t.context.fillRect(0,0,t.canvas.width,t.canvas.height)),i(t.rendererConfig.renderer(t.context,t.canvas.width,t.canvas.height))):i(!1)})))))}paint(){let t=this.context;t.strokeStyle=this.style.borderColor,t.lineWidth=1,t.strokeRect(this.position.x,this.position.y,this.width,this.height);let i=this.offCanvasConfigs.filter((t=>t.rendererConfig.auto));this.customRender(i).then((t=>{t.forEach(((t,e)=>i[e].shouldRender=t))})),this.offCanvasConfigs.forEach((i=>{t.drawImage(i.canvas,0,0,i.canvas.width,i.canvas.height,this.position.x,this.position.y,this.node.width-2*this.node.style.padding,this.height)}))}paintLOD1(){let t=this.context;t.strokeStyle=this.style.borderColor,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle="lightgrey",t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let t=(this.node.width-2*this.node.style.padding)*this.node.flow.flowConnect.scale,i=this.height*this.node.flow.flowConnect.scale;this.offCanvasConfigs.forEach((e=>{Math.floor(e.canvas.width)===Math.floor(t)&&Math.floor(e.canvas.height)===Math.floor(i)||(e.canvas.width=t,e.canvas.height=i,e.shouldRender||(e.rendererConfig.renderer(e.context,e.canvas.width,e.canvas.height),e.shouldRender=!1))})),this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2)}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled||this.call("rightclick",this)}serialize(){return{height:this.height,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,id:this.id,hitColor:this.hitColor.serialize(),style:this.style,type:this.type,childs:[]}}static deSerialize(t,i){return new r(t,i.height,null,{style:i.style,id:i.id,hitColor:s.Color.deSerialize(i.hitColor),clear:i.input})}}var l;i.Display=r,function(t){t[t.OffscreenCanvas=0]="OffscreenCanvas",t[t.HTMLCanvasElement=1]="HTMLCanvasElement"}(l=i.CanvasType||(i.CanvasType={}));let a=()=>({borderColor:"#000",visible:!0}),u=()=>({})},9440:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Envelope=void 0;const s=e(7892),o=e(2681),n=e(7900),h=e(1278),r=e(6894),l=e(3612),a=e(8240),u=e(296);class d extends o.UINode{constructor(t,i,e=[],r=c()){super(t,s.Vector2.Zero(),o.UIType.Envelope,{draggable:!0,style:r.style?{...p(),...r.style}:p(),input:r.input&&("boolean"==typeof r.input?new n.Terminal(t,n.TerminalType.IN,"array","",{}):n.Terminal.deSerialize(t,r.input)),output:r.output&&("boolean"==typeof r.output?new n.Terminal(t,n.TerminalType.OUT,"array","",{}):n.Terminal.deSerialize(t,r.output)),id:r.id,hitColor:r.hitColor}),this.pointHitColorPoint=new u.BiMap,this.pointDiameter=10,this.height=i,e.forEach((t=>t.clampInPlace(0,1,0,1))),e.sort(((t,i)=>t.x-i.x)),this._value=new a.List(((t,i)=>t.x-i.x),e),this.pointHitColorPoint.clear(),this._value.forEach((t=>this.pointHitColorPoint.set(h.Color.Random().hexValue,t))),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),"undefined"!=typeof OffscreenCanvas?this.offPointsCanvas=new OffscreenCanvas(this.width,this.height):(this.offPointsCanvas=document.createElement("canvas"),this.offPointsCanvas.width=this.width,this.offPointsCanvas.height=this.height),this.offPointsContext=this.offPointsCanvas.getContext("2d"),this.renderOffPoints()}get value(){return this._value.toArray().map((t=>t.clone()))}set value(t){let i=this.value;t.forEach((t=>t.clampInPlace(0,1,0,1))),t.sort(((t,i)=>t.x-i.x)),this._value=new a.List(((t,i)=>t.x-i.x),t),this.pointHitColorPoint.clear(),this._value.forEach((t=>this.pointHitColorPoint.set(h.Color.Random().hexValue,t))),this.renderOffPoints(),this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,i,this._value.toArray())}renderOffPoints(){let[t,i]=[this.width-this.pointDiameter,this.height-this.pointDiameter];this.offPointsContext.clearRect(0,0,t,i),this._value.forEach((e=>{let o=new s.Vector2(e.data.x,1-e.data.y).multiply(t,i).add(this.pointDiameter/2);this.offPointsContext.fillStyle=this.pointHitColorPoint.get(e),this.offPointsContext.beginPath(),this.offPointsContext.arc(o.x,o.y,this.pointDiameter/2,0,l.Constant.TAU),this.offPointsContext.fill()}))}paint(){let t=this.node.context;t.fillStyle=this.style.backgroundColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.fillRect(this.position.x,this.position.y,this.width,this.height),t.strokeRect(this.position.x,this.position.y,this.width,this.height);let[i,e]=[this.width-this.pointDiameter,this.height-this.pointDiameter],o=this._value.map((t=>new s.Vector2(t.data.x,1-t.data.y).multiplyInPlace(i,e).addInPlace(this.position).addInPlace(this.pointDiameter/2)));o.length>0&&(t.strokeStyle=this.style.lineColor,t.lineWidth=2,t.beginPath(),t.moveTo(this.position.x,o[0].y),o.forEach((i=>t.lineTo(i.x,i.y))),t.lineTo(this.position.x+this.width,o[o.length-1].y),t.stroke()),t.fillStyle=this.style.pointColor,o.forEach((i=>{t.beginPath(),t.arc(i.x,i.y,this.pointDiameter/2,0,l.Constant.TAU),t.fill()}))}paintLOD1(){this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let[t,i]=[this.width,this.height];Math.floor(this.offPointsCanvas.width)===Math.floor(t)&&Math.floor(this.offPointsCanvas.height)===Math.floor(i)||(this.offPointsCanvas.width=t,this.offPointsCanvas.height=i,this.renderOffPoints()),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}getHitPoint(t){let i=t.subtract(this.position),e=h.Color.rgbaToHex(this.offPointsContext.getImageData(i.x,i.y,1,1).data);return this.pointHitColorPoint.get(e)}movePoint(t){let[i,e]=[this.width-this.pointDiameter,this.height-this.pointDiameter];this.currHitPoint.data=t.clamp(this.position.x+this.pointDiameter/2,this.position.x+this.width-this.pointDiameter/2,this.position.y+this.pointDiameter/2,this.position.y+this.height-this.pointDiameter/2).subtractInPlace(this.position.add(this.pointDiameter/2)).clampInPlace(0,i,0,e).normalizeInPlace(0,i,0,e).clampInPlace(this.currHitPoint.prev?.data.x||0,this.currHitPoint.next?.data.x||1,-1/0,1/0),this.currHitPoint.data=new s.Vector2(this.currHitPoint.data.x,1-this.currHitPoint.data.y),this.renderOffPoints()}newPoint(t,i,e){let o,n=this._value.toArray(),l=t.subtract(this.position.add(this.pointDiameter/2)).normalizeInPlace(0,i,0,e);l=new s.Vector2(l.x,1-l.y);let a=this._value.searchTail((t=>t.data.x<=l.x));o=null===a?this._value.prepend(l):this._value.addAfter(l,a),this.pointHitColorPoint.set(h.Color.Random().hexValue,o),this.renderOffPoints(),this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,n,this._value.toArray())}deletePoint(){let t=this._value.toArray();this._value.delete(this.currHitPoint),this.pointHitColorPoint.delete(this.currHitPoint),this.renderOffPoints(),this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,t,this._value.toArray())}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||(this.currHitPoint=this.getHitPoint(i),this.lastDownPosition=i,this.call("down",this,t,i))}onUp(t,i){if(this.disabled)return;let[e,o]=[this.width-this.pointDiameter,this.height-this.pointDiameter];!this.currHitPoint&&this.lastDownPosition?s.Vector2.Distance(this.lastDownPosition,i)<=2&&this.newPoint(i,e,o):this.currHitPoint&&this.currHitPoint===this.getHitPoint(i)&&this.lastDownPosition&&this.lastDownPosition.isEqual(i,.5)?this.deletePoint():this.currHitPoint&&this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,null,this._value.toArray()),this.currHitPoint=null,this.lastDownPosition=null,this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||(this.currHitPoint&&this.movePoint(i),this.call("drag",this,t,i))}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||(this.currHitPoint&&(this.movePoint(i),this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,null,this._value.toArray())),this.currHitPoint=null,this.lastDownPosition=null,this.call("exit",this,t,i))}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{values:this.value.map((t=>t.serialize())),propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,id:this.id,hitColor:this.hitColor.serialize(),style:this.style,height:this.height,type:this.type,childs:[]}}static deSerialize(t,i){return new d(t,i.height,i.values.map((t=>s.Vector2.deSerialize(t))),{input:i.input,output:i.output,style:i.style,id:i.id,hitColor:h.Color.deSerialize(i.hitColor)})}}i.Envelope=d;let p=()=>({backgroundColor:"#4a4a4a",pointColor:"#9cffee",lineColor:"#9cd6ff",borderColor:"#000",borderWidth:1,visible:!0}),c=()=>({})},8104:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.HorizontalLayout=void 0;const s=e(1278),o=e(7892),n=e(3283),h=e(5818),r=e(119),l=e(7799),a=e(560),u=e(5120),d=e(4136),p=e(2526),c=e(8002),f=e(8735),g=e(6369),y=e(2681),m=e(974),w=e(7900);class C extends y.UINode{constructor(t,i=[],e=b()){super(t,o.Vector2.Zero(),y.UIType.HorizontalLayout,{style:e.style?{...x(),...e.style}:x(),input:e.input&&("boolean"==typeof e.input?new w.Terminal(t,w.TerminalType.IN,"any","",{}):w.Terminal.deSerialize(t,e.input)),output:e.output&&("boolean"==typeof e.output?new w.Terminal(t,w.TerminalType.OUT,"any","",{}):w.Terminal.deSerialize(t,e.output)),id:e.id,hitColor:e.hitColor}),i&&i.length>0&&this.children.push(...i)}paint(){}paintLOD1(){}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let t=this.children.filter((t=>t.visible)),i=this.width-(t.length>0?t.length-1:0)*this.style.spacing,e=i,s=0;t.forEach((t=>s=Math.max(s,t.height))),this.height=s;let o=this.children.filter((t=>!!t.width));o.forEach((t=>t.width=(0,m.clamp)(t.width,0,i)));let n=o.reduce(((t,i)=>t+i.width),0),h=e;n=(0,m.clamp)(n,0,h),h-=n;let r=h,l=this.position.x;t.forEach((t=>{let e,s;e=t.width?t.width:"number"==typeof t.style.grow?t.style.grow*r:0,e=(0,m.clamp)(e,0,i),t.width=e,t.height<this.height?s=this.position.y+this.height/2-t.height/2:(t.height=this.height,s=this.position.y),t.position.assign(l,s),i-=e,l+=e+this.style.spacing})),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2),this.node.ui.reflow()}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){}serialize(){return{propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,id:this.id,style:this.style,hitColor:this.hitColor.serialize(),type:this.type,childs:this.children.map((t=>t.serialize()))}}static deSerialize(t,i){let e=new C(t,[],{style:i.style,input:i.input,output:i.output,id:i.id,hitColor:s.Color.deSerialize(i.hitColor)});return e.children.push(...i.childs.map((i=>{switch(i.type){case y.UIType.Button:return n.Button.deSerialize(t,i);case y.UIType.Container:return h.Container.deSerialize(t,i);case y.UIType.Display:return r.Display.deSerialize(t,i);case y.UIType.HorizontalLayout:return C.deSerialize(t,i);case y.UIType.Stack:return f.Stack.deSerialize(t,i);case y.UIType.Image:return l.Image.deSerialize(t,i);case y.UIType.Input:return a.Input.deSerialize(t,i);case y.UIType.Label:return u.Label.deSerialize(t,i);case y.UIType.Select:return d.Select.deSerialize(t,i);case y.UIType.Slider:return p.Slider.deSerialize(t,i);case y.UIType.Source:return c.Source.deSerialize(t,i);case y.UIType.Toggle:return g.Toggle.deSerialize(t,i);default:return}}))),e}}i.HorizontalLayout=C;let x=()=>({spacing:0,visible:!0}),b=()=>({})},7799:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Image=void 0;const s=e(1278),o=e(7892),n=e(5124),h=e(6645),r=e(2681),l=e(712),a=e(7900),u=e(6894),d=e(974);class p extends r.UINode{constructor(t,i,e=f()){super(t,o.Vector2.Zero(),r.UIType.Image,{style:e.style?{...c(),...e.style}:c(),propName:e.propName,input:e.input&&("boolean"==typeof e.input?new a.Terminal(t,a.TerminalType.IN,"string","",{}):a.Terminal.deSerialize(t,e.input)),output:e.output&&("boolean"==typeof e.output?new a.Terminal(t,a.TerminalType.OUT,"string","",{}):a.Terminal.deSerialize(t,e.output)),id:e.id,hitColor:e.hitColor}),this._src=(0,d.get)(i,n.imageIcon),this.setupImage()}get src(){return this.propName?this.getProp():this._src}set src(t){let i=this._src,e=t;this.propName?this.setProp(e):this._src=e,this.setupImage(),this.node.flow.state!==u.FlowState.Stopped&&this.call("change",this,i,e)}setupImage(){this.source||(this.source=document.createElement("img"),this.source.onerror=t=>h.Log.error(t),this.source.onload=()=>{this.imageCanvas.width=this.source.width,this.imageCanvas.height=this.source.height,this.imageContext.drawImage(this.source,0,0),this.ratio=this.source.width/this.source.height,this.reflow(),this.node.ui.update()}),this.imageCanvas||("undefined"!=typeof OffscreenCanvas?this.imageCanvas=new OffscreenCanvas(0,0):(this.imageCanvas=document.createElement("canvas"),this.imageCanvas.width=0,this.imageCanvas.height=0),this.imageContext=this.imageCanvas.getContext("2d")),this.source.src=this._src}paint(){if(this.imageCanvas&&this.imageCanvas.width>0&&this.imageCanvas.height>0){let t=this.position.x;this.source.width<this.node.ui.contentWidth&&(this.style.align===l.Align.Center?t+=this.node.ui.contentWidth/2-this.source.width/2:this.style.align===l.Align.Right&&(t+=+(this.node.ui.contentWidth-this.source.width))),this.context.drawImage(this.imageCanvas,0,0,this.source.width,this.source.height,t,this.position.y,this.source.width<this.width?this.source.width:this.width,this.height)}}paintLOD1(){if(this.imageCanvas){let t=this.position.x;this.source.width<this.node.ui.contentWidth&&(this.style.align===l.Align.Center?t+=this.node.ui.contentWidth/2-this.source.width/2:this.style.align===l.Align.Right&&(t+=+(this.node.ui.contentWidth-this.source.width)));let i=this.context;i.fillStyle="lightgrey",i.strokeStyle="#000",i.fillRect(t,this.position.y,this.source.width<this.width?this.source.width:this.width,this.height),i.strokeRect(t,this.position.y,this.source.width<this.width?this.source.width:this.width,this.height)}}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue;let t=this.position.x;this.source.width<this.node.ui.contentWidth&&(this.style.align===l.Align.Center?t+=this.node.ui.contentWidth/2-this.source.width/2:this.style.align===l.Align.Right&&(t+=+(this.node.ui.contentWidth-this.source.width))),this.offUIContext.fillRect(t,this.position.y,this.source.width<this.width?this.source.width:this.width,this.height)}reflow(){this.source.width&&this.source.height&&(this.source.width>this.width?this.height=this.width/this.ratio:(this.width=this.source.width,this.height=this.source.height),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2))}onPropChange(t,i){this._src=i,this.setupImage(),this.output&&this.output.setData(i)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){}serialize(){return{source:this._src,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new p(t,i.source,{propName:i.propName,input:i.input,output:i.output,style:i.style,id:i.id,hitColor:s.Color.deSerialize(i.hitColor)})}}i.Image=p;let c=()=>({align:l.Align.Left,visible:!0}),f=()=>({})},8637:function(t,i,e){var s=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),o=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||s(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),o(e(3283),i),o(e(5818),i),o(e(119),i),o(e(8104),i),o(e(7799),i),o(e(560),i),o(e(5120),i),o(e(4136),i),o(e(2526),i),o(e(8002),i),o(e(8735),i),o(e(6369),i),o(e(2681),i)},560:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InputType=i.Input=void 0;const s=e(7892),o=e(2681),n=e(5120),h=e(7900),r=e(1278),l=e(6894),a=e(712),u=e(974);class d extends o.UINode{constructor(t,i=f(t)){super(t,s.Vector2.Zero(),o.UIType.Input,{style:i.style?{...c(),...i.style}:c(),propName:i.propName,input:i.input&&("boolean"==typeof i.input?new h.Terminal(t,h.TerminalType.IN,i.style.type,"",{}):h.Terminal.deSerialize(t,i.input)),output:i.output&&("boolean"==typeof i.output?new h.Terminal(t,h.TerminalType.OUT,i.style.type,"",{}):h.Terminal.deSerialize(t,i.output)),id:i.id,hitColor:i.hitColor}),this.height=(0,u.get)(i.height,this.node.style.rowHeight),this.style.type===p.Number&&"string"==typeof i.value&&(i.value=parseFloat(i.value)),this._value=i.value,this.setupLabel(),this.setupInputElement(),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),this.node.on("process",(()=>{this.output&&this.output.setData(this.value)}))}get value(){return this.propName?this.getProp():this._value}set value(t){let i;i=this.style.type===p.Number&&"string"==typeof t?parseFloat(t):t;let e=this.value,s=i;this.propName?this.setProp(s):(this._value=s,this.setLabelText(this._value),this.inputEl.value=this._value.toString()),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,s,e)}setupLabel(){this.label=new n.Label(this.node,this.value.toString(),{style:{fontSize:this.style.fontSize,font:this.style.font,align:this.style.align,color:this.style.color,padding:5,precision:this.style.precision||null},height:this.height}),this.label.on("click",(()=>{if(document.activeElement!==this.inputEl){let t=this.position.transform(this.node.flow.flowConnect.transform);Object.assign(this.inputEl.style,{visibility:"visible","pointer-events":"all",top:t.y+this.node.flow.flowConnect.canvasDimensions.top+1+"px",left:t.x+this.node.flow.flowConnect.canvasDimensions.left+1+"px",width:(this.width-1)*this.node.flow.flowConnect.scale+"px",height:(this.height-1)*this.node.flow.flowConnect.scale+"px","font-family":this.style.font,"font-size":parseInt(this.style.fontSize.replace("px",""))*this.node.flow.flowConnect.scale+"px",color:this.style.color,"background-color":this.inputEl.validity.patternMismatch?"red":this.style.backgroundColor,"text-align":this.style.align}),this.style.type===p.Number&&(this.inputEl.step=this.style.step),this.inputEl.focus()}})),this.children.push(this.label)}setupInputElement(){this.inputEl=document.createElement("input"),this.inputEl.className="flow-connect-input",this.inputEl.spellcheck=!1;let t="string"===this.style.type?"text":this.style.type;this.inputEl.type=this.style.pattern?"text":t,this.inputEl.value=this.value.toString(),this.style.pattern&&(this.inputEl.pattern=this.style.pattern),this.style.type===p.Number&&this.style.step&&(this.inputEl.step=this.style.step),this.style.maxLength&&(this.inputEl.maxLength=this.style.maxLength),this.inputEl.addEventListener("blur",(()=>{this.inputEl.style.visibility="hidden",this.inputEl.style.pointerEvents="none",this.value=this.inputEl.value,this.setLabelText(this.style.type===p.Number?parseFloat(this.value):this.value.toString()),this.call("blur",this)})),this.inputEl.oninput=()=>{this.style.pattern&&(this.inputEl.style.backgroundColor=this.inputEl.validity.patternMismatch?"orange":this.style.backgroundColor,this.label.style.color=this.inputEl.validity.patternMismatch?"orange":this.style.color),this.call("input",this)},document.body.appendChild(this.inputEl)}setLabelText(t){this.label.text="number"==typeof t&&(0,u.exists)(this.style.precision)?t.toFixed(this.style.precision):t}paint(){this.context.strokeStyle=this.style.border,this.context.strokeRect(this.position.x,this.position.y,this.width,this.height)}paintLOD1(){let t=this.context;t.strokeStyle=this.style.border,t.fillStyle=this.style.backgroundColor,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.label.position=this.position,this.label.height=this.height,this.label.width=this.width,this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this.style.type===p.Number&&"string"==typeof i&&(i=parseFloat(i)),this._value=i,this.setLabelText(this._value),this.inputEl.value=this._value.toString(),this.output&&this.output.setData(this._value)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{value:this.value,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new d(t,{value:i.value,propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}var p;i.Input=d,function(t){t.Text="string",t.Number="number"}(p=i.InputType||(i.InputType={}));let c=()=>({backgroundColor:"#eee",color:"#000",fontSize:"11px",font:"arial",border:"1px solid black",align:a.Align.Left,type:p.Text}),f=t=>({height:1.5*t.style.rowHeight})},5120:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Label=void 0;const s=e(7900),o=e(7892),n=e(2681),h=e(1278),r=e(974),l=e(6894),a=e(712);class u extends n.UINode{constructor(t,i,e=p(t)){super(t,o.Vector2.Zero(),n.UIType.Label,{style:e.style?{...d(),...e.style}:d(),propName:e.propName,input:e.input&&("boolean"==typeof e.input?new s.Terminal(t,s.TerminalType.IN,"any","",{}):s.Terminal.deSerialize(t,e.input)),output:e.output&&("boolean"==typeof e.output?new s.Terminal(t,s.TerminalType.OUT,"string","",{}):s.Terminal.deSerialize(t,e.output)),id:e.id,hitColor:e.hitColor}),this._text=this.propName?this.getProp():i,this.reflow(),this.height=(0,r.get)(e.height,this.textHeight+5),this.style.grow||(this.width=this.orgTextWidth),this.input&&(this.input.on("connect",((t,i)=>{(0,r.exists)(i.data)&&(this.text=i.data)})),this.input.on("data",((t,i)=>{(0,r.exists)(i)&&(this.text=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.text)),this.node.on("process",(()=>{this.output&&this.output.setData(this.text)}))}get text(){let t;return t=this.propName?this.getProp():this._text,"number"==typeof t&&(t=this.format(t)),t}set text(t){let i=this._text,e=t;this.propName?this.setProp(e):(this._text=e,this.reflow()),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,i,e)}paint(){let t=this.context;t.fillStyle=this.style.backgroundColor,t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle=this.style.color,t.font=this.style.fontSize+" "+this.style.font,t.textBaseline="middle";let i=this.position.y+this.height/2,e=this.position.x;this.style.align===a.Align.Center?e+=this.width/2-this.textWidth/2:this.style.align===a.Align.Right?e+=this.width-this.textWidth-this.style.padding:e+=this.style.padding,t.fillText(this.displayText,e,i)}paintLOD1(){let t=this.context;t.strokeStyle="#000",t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let t=this.context;t.font=this.style.fontSize+" "+this.style.font,this.orgTextWidth=t.measureText(this.text).width,this.displayText=this.getBestFitString();let i=t.measureText(this.displayText);t.font=null,this.textWidth=i.width,this.textHeight=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+5,this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}getBestFitString(){let t=this.text;"string"!=typeof t&&(t=t.toString());let i=this.context.measureText(t).width;const e=this.context.measureText("").width;if(i<=this.width||i<=e)return t;const s=(0,r.binarySearch)({max:t.length,getValue:i=>this.context.measureText(t.substring(0,i)).width,match:this.width-e});return t.substring(0,s)+""}format(t){return(0,r.exists)(this.style.precision)?t.toFixed(this.style.precision):t.toString()}onPropChange(t,i){this._text=i,this.reflow(),this.output&&this.output.setData(this._text)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{text:this.text,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,i.text,{propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:h.Color.deSerialize(i.hitColor)})}}i.Label=u;let d=()=>({color:"#000",backgroundColor:"transparent",fontSize:"11px",font:"arial",align:a.Align.Left,padding:0,visible:!0}),p=t=>({height:1.5*t.style.rowHeight})},6518:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RadioGroup=void 0;const s=e(7900),o=e(7892),n=e(2681),h=e(1278),r=e(6894),l=e(5120),a=e(712),u=e(974);class d extends n.UINode{constructor(t,i=["default"],e="default",h=c(t)){super(t,o.Vector2.Zero(),n.UIType.RadioGroup,{style:h.style?{...p(),...h.style}:p(),propName:h.propName,input:h.input&&("boolean"==typeof h.input?new s.Terminal(t,s.TerminalType.IN,"boolean","",{}):s.Terminal.deSerialize(t,h.input)),output:h.output&&("boolean"==typeof h.output?new s.Terminal(t,s.TerminalType.OUT,"boolean","",{}):s.Terminal.deSerialize(t,h.output)),id:h.id,hitColor:h.hitColor}),0===i.length&&(i=["default"]),this._values=i;let r=this.propName?this.getProp():e;this._selected=this._values.includes(r)?r:this._values[0],this.height=(0,u.get)(h.height,this.node.style.rowHeight),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this._selected=i.data)})),this.input.on("data",((t,i)=>{void 0!==i&&(this._selected=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this._selected)),this.setupLabels(),this.node.on("process",(()=>{this.output&&this.output.setData(this._selected)}))}get selected(){return this.propName?this.getProp():this._selected}set selected(t){this._values.includes(t)||(t=this._values[0]);let i=this.selected,e=t;this.propName?this.setProp(e):this._selected=e,this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,i,e)}setupLabels(){this.children.push(...this._values.map((t=>{let i=new l.Label(this.node,t,{style:{align:a.Align.Center,backgroundColor:this.style.backgroundColor,color:this.style.color}});return i.on("click",(t=>{if(t.text===this.selected)return;let i=this.children[this._values.indexOf(this.selected)];Object.assign(i.style,{backgroundColor:this.style.backgroundColor,color:this.style.color}),Object.assign(t.style,{backgroundColor:this.style.selectedBackgroundColor,color:this.style.selectedColor}),this.selected=t.text})),i}))),Object.assign(this.children[this._values.indexOf(this._selected)].style,{backgroundColor:this.style.selectedBackgroundColor,color:this.style.selectedColor})}paint(){let t=this.context;t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderWidth,t.strokeRect(this.position.x,this.position.y,this.width,this.height);let i=this.width/this.children.length,e=this.position.x+i;for(let s=0;s<this.children.length-1;s+=1)t.beginPath(),t.moveTo(e,this.position.y),t.lineTo(e,this.position.y+this.height),t.stroke(),e+=i}paintLOD1(){let t=this.context;t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let t=this.position.x;this.children.forEach((i=>{i.height=this.height,i.width=this.width/this.children.length,i.position.assign(t,this.position.y),t+=i.width})),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this._values.includes(i)||(i=this._values[0]),this._selected=i,this.output&&this.output.setData(this._selected)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{values:this._values,selected:this.selected,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new d(t,i.values,i.selected,{propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:h.Color.deSerialize(i.hitColor)})}}i.RadioGroup=d;let p=()=>({color:"#000",selectedColor:"#fff",backgroundColor:"transparent",selectedBackgroundColor:"#555",borderColor:"#000",borderWidth:1,visible:!0}),c=t=>({height:1.5*t.style.rowHeight})},4136:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Select=void 0;const s=e(7900),o=e(7892),n=e(5120),h=e(2681),r=e(3612),l=e(1278),a=e(6894),u=e(712),d=e(974);class p extends h.UINode{constructor(t,i=[],e=f(t)){super(t,o.Vector2.Zero(),h.UIType.Select,{style:e.style?{...c(),...e.style}:c(),propName:e.propName,input:e.input&&("boolean"==typeof e.input?new s.Terminal(t,s.TerminalType.IN,"string","",{}):s.Terminal.deSerialize(t,e.input)),output:e.output&&("boolean"==typeof e.output?new s.Terminal(t,s.TerminalType.OUT,"string","",{}):s.Terminal.deSerialize(t,e.output)),id:e.id,hitColor:e.hitColor}),this.values=i,this.height=(0,d.get)(e.height,this.node.style.rowHeight),this._selected=0===this.values.length?"None":this.values[0],this.label=new n.Label(this.node,this.selected,{style:{align:u.Align.Center,...this.style},height:this.height}),this.children.push(this.label),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.selected=i.data)})),this.input.on("data",((t,i)=>{i&&(this.selected=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.selected)),this.node.on("process",(()=>{this.output&&this.output.setData(this.selected)}))}get selected(){if(this.propName){let t=this.getProp(),i=this.values.includes(t)?t:this.values[0];return t=0===this.values.length?"None":i,t}return this._selected}set selected(t){let i=this.values.includes(t)?t:this.values[0],e=this.selected,s=0===this.values.length?"None":i;this.propName?this.setProp(s):(this._selected=s,this.label.text=s),this.node.flow.state!==a.FlowState.Stopped&&this.call("change",this,e,s)}paint(){let t=this.context;t.fillStyle=this.style.arrowColor,t.beginPath(),t.moveTo(this.position.x,this.position.y+this.height/2),t.lineTo(this.position.x+this.height*r.Constant.SIN_60,this.position.y),t.lineTo(this.position.x+this.height*r.Constant.SIN_60,this.position.y+this.height),t.lineTo(this.position.x,this.position.y+this.height/2),t.closePath(),t.fill(),t.fillStyle=this.style.arrowColor,t.beginPath(),t.moveTo(this.position.x+this.width,this.position.y+this.height/2),t.lineTo(this.position.x+this.width-this.height*r.Constant.SIN_60,this.position.y),t.lineTo(this.position.x+this.width-this.height*r.Constant.SIN_60,this.position.y+this.height),t.lineTo(this.position.x+this.width,this.position.y+this.height/2),t.closePath(),t.fill()}paintLOD1(){let t=this.context;t.fillStyle=this.style.arrowColor,t.strokeStyle="#000",t.fillRect(this.position.x,this.position.y,this.width,this.height),t.strokeRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.label.width=.7*this.width,this.label.position.assign(this.position.x+.15*this.width,this.position.y+this.height/2-this.label.height/2),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){let e=this.values.includes(i)?i:this.values[0],s=0===this.values.length?"None":e;this._selected=s,this.label.text=this._selected,this.output&&this.output.setData(this.selected)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){if(this.disabled)return;if(0===this.values.length)return;let e;if(i.x<this.position.x+.15*this.width)e=-1;else{if(!(i.x>this.position.x+.85*this.width))return;e=1}let s=this.values.length;this.selected=this.values[((this.values.indexOf(this.selected)+e)%s+s)%s],this.label.text=this.selected,this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{values:this.values,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new p(t,i.values,{propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:l.Color.deSerialize(i.hitColor)})}}i.Select=p;let c=()=>({arrowColor:"#000",visible:!0}),f=t=>({height:1.5*t.style.rowHeight})},2526:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Slider=void 0;const s=e(7900),o=e(7892),n=e(974),h=e(2681),r=e(1278),l=e(6894),a=e(3612);class u extends h.UINode{constructor(t,i,e,r=p(t)){super(t,o.Vector2.Zero(),h.UIType.Slider,{draggable:!0,style:r.style?{...d(t,r.height),...r.style}:d(t,r.height),propName:r.propName,input:r.input&&("boolean"==typeof r.input?new s.Terminal(t,s.TerminalType.IN,"number","",{}):s.Terminal.deSerialize(t,r.input)),output:r.output&&("boolean"==typeof r.output?new s.Terminal(t,s.TerminalType.OUT,"number","",{}):s.Terminal.deSerialize(t,r.output)),id:r.id,hitColor:r.hitColor}),this.min=i,this.max=e,this.height=(0,n.get)(r.height,this.node.style.rowHeight),this._value=this.propName?this.getProp():(0,n.get)(r.value,i),this._value=(0,n.clamp)(this._value,this.min,this.max),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),this.node.on("process",(()=>{this.output&&this.output.setData(this.value)}))}get value(){return this.propName?this.getProp():this._value}set value(t){t=(0,n.clamp)(t,this.min,this.max);let i=this.value,e=t;e=(0,n.exists)(this.style.precision)?parseFloat(e.toFixed(this.style.precision)):e,this.propName?this.setProp(e):(this._value=e,this.reflow()),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,i,e)}paint(){let t=this.context;t.lineWidth=this.style.railHeight,t.strokeStyle=this.style.color,t.lineCap="butt";let i=Math.max(this.position.x,this.position.x+this.thumbFill-3);i!==this.position.x&&(t.beginPath(),t.moveTo(this.position.x,this.position.y+this.height/2),t.lineTo(i,this.position.y+this.height/2),t.stroke()),i=Math.min(this.position.x+2*this.style.thumbRadius+this.thumbFill+3,this.position.x+this.width),i!==this.position.x+this.width&&(t.beginPath(),t.moveTo(i,this.position.y+this.height/2),t.lineTo(this.position.x+this.width,this.position.y+this.height/2),t.stroke()),t.fillStyle=this.style.thumbColor,t.beginPath(),t.arc(this.position.x+this.style.thumbRadius+this.thumbFill,this.position.y+this.height/2,this.style.thumbRadius,0,a.Constant.TAU),t.fill()}paintLOD1(){let t=this.context;t.strokeStyle="#000",t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.thumbFill=(0,n.denormalize)((0,n.normalize)(this.value,this.min,this.max),0,this.width-2*this.style.thumbRadius),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this._value=i,this.reflow(),this.output&&this.output.setData(this.value)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){if(this.disabled)return;let e=this.position.y+this.height/2-this.style.railHeight/2;this.thumbFill=i.clamp(this.position.x+this.style.thumbRadius,this.position.x+this.width-this.style.thumbRadius,e,e).subtractInPlace(this.position.x+this.style.thumbRadius,0).x,this.value=(0,n.denormalize)((0,n.normalize)(this.thumbFill,0,this.width-2*this.style.thumbRadius),this.min,this.max),this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{min:this.min,max:this.max,value:this.value,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,i.min,i.max,{value:i.value,propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}i.Slider=u;let d=(t,i)=>({color:"#444",thumbColor:"#000",railHeight:3,thumbRadius:void 0!==i?i/2:1.5*t.style.rowHeight/2}),p=t=>({height:1.5*t.style.rowHeight})},8002:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Source=void 0;const s=e(7900),o=e(7892),n=e(5124),h=e(7799),r=e(5120),l=e(2681),a=e(1278),u=e(6894),d=e(712),p=e(974);class c extends l.UINode{constructor(t,i=g(t)){super(t,o.Vector2.Zero(),l.UIType.Source,{style:i.style?{...f(),...i.style}:f(),propName:i.propName,input:i.input&&("boolean"==typeof i.input?new s.Terminal(t,s.TerminalType.IN,"file","",{}):s.Terminal.deSerialize(t,i.input)),output:i.output&&("boolean"==typeof i.output?new s.Terminal(t,s.TerminalType.OUT,"file","",{}):s.Terminal.deSerialize(t,i.output)),id:i.id,hitColor:i.hitColor}),this.accept=i.accept,this.height=(0,p.get)(i.height,this.node.style.rowHeight),this.setupInputElement(i),this.label=new r.Label(this.node,"Select",{style:{align:d.Align.Center,...this.style},height:this.height}),this.fileIcon=new h.Image(this.node,n.fileIcon),this.label.on("click",(()=>this.htmlInput.click())),this.children.push(this.label,this.fileIcon),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.file=i.data)})),this.input.on("data",((t,i)=>{i&&(this.file=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.file)),this.node.on("process",(()=>{this.output&&this.output.setData(this.file)}))}get file(){return this.propName?this.getProp():this._file}set file(t){let i=this.file,e=t;this.propName?this.setProp(e):(this._file=e,this.label.text=e.name.substring(0,this._file.name.toString().lastIndexOf("."))),this.node.flow.state!==u.FlowState.Stopped&&this.call("change",this,i,e)}setupInputElement(t){this.htmlInput=document.createElement("input"),this.htmlInput.type="file",t.accept&&(this.htmlInput.accept=t.accept),this.htmlInput.onchange=()=>{if(this.htmlInput.files.length>0){let t=this.file;this.file=this.htmlInput.files[0],this.node.flow.state===u.FlowState.Stopped&&this.call("upload",this,t,this.file)}}}paint(){this.context.strokeStyle=this.style.borderColor,this.context.strokeRect(this.position.x,this.position.y,this.width,this.height)}paintLOD1(){let t=this.context;t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.label.width=this.width,this.label.height=this.height,this.label.position=this.position,this.fileIcon.width=.1*this.width,this.fileIcon.position.assign(this.position.x+5,this.position.y+this.height/2-this.fileIcon.height/2),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this._file=i,this.label.text=this._file.name.substring(0,this._file.name.toString().lastIndexOf(".")),this.output&&this.output.setData(this._file)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{accept:this.accept,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new c(t,{accept:i.accept,propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:a.Color.deSerialize(i.hitColor)})}}i.Source=c;let f=()=>({borderColor:"#000",visible:!0}),g=t=>({height:1.5*t.style.rowHeight})},8735:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Stack=void 0;const s=e(1278),o=e(7892),n=e(3283),h=e(5818),r=e(119),l=e(7799),a=e(560),u=e(5120),d=e(4136),p=e(2526),c=e(8002),f=e(6369),g=e(2681);class y extends g.UINode{constructor(t,i=w()){super(t,o.Vector2.Zero(),g.UIType.Stack,{style:i.style?{...m(),...i.style}:m(),id:i.id,hitColor:i.hitColor}),i.childs&&this.children.push(...i.childs)}paint(){}paintLOD1(){}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){let t=this.children.filter((t=>t.visible)),i=t.reduce(((t,i)=>t+i.height),0),e=(t.length-1)*this.style.spacing;this.height=i+e;let s=this.position.y;t.forEach((t=>{t.position.assign(this.position.x,s),t.width=this.width,s+=t.height+this.style.spacing}))}onPropChange(){}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){}serialize(){return{style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,propName:null,input:null,output:null,childs:this.children.map((t=>t.serialize()))}}static deSerialize(t,i){let e=new y(t,{style:i.style,id:i.id,hitColor:s.Color.deSerialize(i.hitColor),childs:[]});return e.children.push(...i.childs.map((i=>{switch(i.type){case g.UIType.Button:return n.Button.deSerialize(t,i);case g.UIType.Container:return h.Container.deSerialize(t,i);case g.UIType.Display:return r.Display.deSerialize(t,i);case g.UIType.HorizontalLayout:case g.UIType.Stack:return y.deSerialize(t,i);case g.UIType.Image:return l.Image.deSerialize(t,i);case g.UIType.Input:return a.Input.deSerialize(t,i);case g.UIType.Label:return u.Label.deSerialize(t,i);case g.UIType.Select:return d.Select.deSerialize(t,i);case g.UIType.Slider:return p.Slider.deSerialize(t,i);case g.UIType.Source:return c.Source.deSerialize(t,i);case g.UIType.Toggle:return f.Toggle.deSerialize(t,i);default:return}}))),e}}i.Stack=y;let m=()=>({spacing:0,visible:!0}),w=()=>({})},6369:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Toggle=void 0;const s=e(7900),o=e(7892),n=e(2681),h=e(1278),r=e(6894),l=e(974),a=e(3612);class u extends n.UINode{constructor(t,i=d(t)){super(t,o.Vector2.Zero(),n.UIType.Toggle,{style:i.style?{...p(),...i.style}:p(),propName:i.propName,input:i.input&&("boolean"==typeof i.input?new s.Terminal(t,s.TerminalType.IN,"boolean","",{}):s.Terminal.deSerialize(t,i.input)),output:i.output&&("boolean"==typeof i.output?new s.Terminal(t,s.TerminalType.OUT,"boolean","",{}):s.Terminal.deSerialize(t,i.output)),id:i.id,hitColor:i.hitColor}),this._checked=!1,this._checked=this.propName?this.getProp():i.value,this.height=(0,l.get)(i.height,this.node.style.rowHeight),this.style.grow||(this.width=2.5*this.height),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.checked=i.data)})),this.input.on("data",((t,i)=>{void 0!==i&&(this.checked=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.checked)),this.node.on("process",(()=>{this.output&&this.output.setData(this.checked)}))}get checked(){return this.propName?this.getProp():this._checked}set checked(t){let i=this.checked,e=t;this.propName?this.setProp(e):this._checked=e,this.node.flow.state!==r.FlowState.Stopped&&this.call("change",this,i,e)}paint(){let t=this.context;t.strokeStyle=this.style.backgroundColor,t.lineWidth=.75*this.height,t.lineCap="round",t.beginPath(),t.moveTo(this.position.x+this.context.lineWidth/2,this.position.y+this.height/2),t.lineTo(this.position.x+this.width-this.context.lineWidth/2,this.position.y+this.height/2),t.stroke(),t.fillStyle=this.style.color,t.beginPath(),t.arc(this.checked?this.position.x+this.width-this.height/2:this.position.x+this.height/2,this.position.y+this.height/2,this.height/2,0,a.Constant.TAU),t.fill()}paintLOD1(){let t=this.context;t.strokeStyle=this.style.color,t.fillStyle=this.style.backgroundColor,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this._checked=i,this.output&&this.output.setData(this.checked)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||(this.checked=!this.checked,this.call("click",this,t,i))}onDrag(t,i){this.disabled||this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{checked:this.checked,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,{propName:i.propName,input:i.input,output:i.output,height:i.height,style:i.style,id:i.id,hitColor:h.Color.deSerialize(i.hitColor)})}}i.Toggle=u;let d=t=>({value:!1,height:1.5*t.style.rowHeight}),p=()=>({backgroundColor:"#999",color:"#000",visible:!0})},2681:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UIType=i.UINode=void 0;const s=e(1278),o=e(7417),n=e(7055),h=e(712),r=e(974);class l extends o.Hooks{constructor(t,i,e,s=u()){super(),this.node=t,this.type=e,this.width=0,this.height=0,this.setHitColor(s.hitColor),this.id=(0,r.get)(s.id,(0,r.getNewUUID)()),this.draggable=(0,r.get)(s.draggable,!1),this.zoomable=(0,r.get)(s.zoomable,!1),this._visible=(0,r.get)(s.visible,!0),this.style=(0,r.get)(s.style,{}),this.children=[],this.position=i,this.disabled=!1,this.propName=s.propName,this.propName&&this.node.watch(this.propName,((t,i)=>this.onPropChange(t,i))),this.input=s.input,this.output=s.output,this.input&&(this.node.inputsUI.push(this.input),this.input.on("connect",(()=>this.disabled=!0)),this.input.on("disconnect",(()=>this.disabled=!1))),this.output&&this.node.outputsUI.push(this.output)}get context(){return this.node.context}get offUIContext(){return this.node.offUIContext}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.children.forEach((i=>i.disabled=t))}get visible(){return this._visible}set visible(t){this._visible=t,this.node.ui.update()}append(t){Array.isArray(t)?this.children.push(...t):this.children.push(t),this.update(),this.node.ui.update()}update(){this.reflow(),this.children.forEach((t=>t.update()))}updateRenderState(){if(this.node.renderState.nodeState===n.NodeState.MINIMIZED)return;let t=this.position.transform(this.node.flow.flowConnect.transform);this.renderState=(0,r.intersects)(0,0,this.node.flow.flowConnect.canvasDimensions.width,this.node.flow.flowConnect.canvasDimensions.height,t.x,t.y,t.x+this.width*this.node.flow.flowConnect.scale,t.y+this.height*this.node.flow.flowConnect.scale),this.children.forEach((t=>t.updateRenderState()))}setHitColor(t){if(!t)for(t=s.Color.Random();this.node.hitColorToUI[t.rgbaString]||this.node.hitColorToTerminal[t.rgbaString];)t=s.Color.Random();this.hitColor=t,this.node.hitColorToUI[this.hitColor.rgbaString]=this}render(){if(!this.visible)return;if(this.renderState===h.ViewPort.OUTSIDE)return;let t=this.context;this.node.renderState.lod===h.LOD.LOD1?(t.save(),this.paintLOD1(),t.restore()):this.node.renderState.lod===h.LOD.LOD2?(t.save(),this.paint(),t.restore(),this.offUIContext.save(),this.offPaint(),this.offUIContext.restore()):this.type===a.Container&&(t.save(),this.paintLOD1(),t.restore()),this.node.renderState.lod>0&&(this.input&&this.input.render(),this.output&&this.output.render()),this.children.forEach((t=>t.render()))}getProp(){return this.node.props[this.propName]}setProp(t){this.node.props[this.propName]=t}}var a;i.UINode=l,function(t){t[t.Button=0]="Button",t[t.Container=1]="Container",t[t.Display=2]="Display",t[t.HorizontalLayout=3]="HorizontalLayout",t[t.Stack=4]="Stack",t[t.Image=5]="Image",t[t.Input=6]="Input",t[t.Label=7]="Label",t[t.Select=8]="Select",t[t.Slider=9]="Slider",t[t.Dial=10]="Dial",t[t.Source=11]="Source",t[t.Toggle=12]="Toggle",t[t.Envelope=13]="Envelope",t[t.RadioGroup=14]="RadioGroup",t[t.Slider2D=15]="Slider2D",t[t.VSlider=16]="VSlider"}(a=i.UIType||(i.UIType={}));let u=()=>({draggable:!1,zoomable:!1,visible:!0,style:{},propName:null,input:null,output:null,id:(0,r.getNewUUID)(),hitColor:null})},510:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.VSlider=void 0;const s=e(7900),o=e(7892),n=e(974),h=e(2681),r=e(1278),l=e(6894),a=e(3612);class u extends h.UINode{constructor(t,i,e,r=p(t)){super(t,o.Vector2.Zero(),h.UIType.VSlider,{draggable:!0,style:r.style?{...d(t,r.width),...r.style}:d(t,r.width),propName:r.propName,input:r.input&&("boolean"==typeof r.input?new s.Terminal(t,s.TerminalType.IN,"number","",{}):s.Terminal.deSerialize(t,r.input)),output:r.output&&("boolean"==typeof r.output?new s.Terminal(t,s.TerminalType.OUT,"number","",{}):s.Terminal.deSerialize(t,r.output)),id:r.id,hitColor:r.hitColor}),this.min=i,this.max=e,this.height=(0,n.get)(r.height,5*this.node.style.rowHeight),this.width=(0,n.get)(r.width,this.node.style.rowHeight),this._value=this.propName?this.getProp():(0,n.get)(r.value,i),this._value=(0,n.clamp)(this._value,this.min,this.max),this.input&&(this.input.on("connect",((t,i)=>{i.data&&(this.value=i.data)})),this.input.on("data",((t,i)=>{i&&(this.value=i)}))),this.output&&this.output.on("connect",((t,i)=>i.data=this.value)),this.node.on("process",(()=>{this.output&&this.output.setData(this.value)}))}get value(){return this.propName?this.getProp():this._value}set value(t){t=(0,n.clamp)(t,this.min,this.max);let i=this.value,e=t;this.propName?this.setProp(e):(this._value=e,this.reflow()),this.node.flow.state!==l.FlowState.Stopped&&this.call("change",this,i,e)}paint(){let t=this.context;t.lineWidth=this.style.railWidth,t.strokeStyle=this.style.color,t.lineCap="butt";let i=Math.max(this.position.y,this.position.y+this.thumbFill-3);i!==this.position.y&&(t.beginPath(),t.moveTo(this.position.x+this.width/2,this.position.y),t.lineTo(this.position.x+this.width/2,i),t.stroke()),i=Math.min(this.position.y+2*this.style.thumbRadius+this.thumbFill+3,this.position.y+this.height),i!==this.position.y+this.height&&(t.beginPath(),t.moveTo(this.position.x+this.width/2,i),t.lineTo(this.position.x+this.width/2,this.position.y+this.height),t.stroke()),t.fillStyle=this.style.thumbColor,t.beginPath(),t.arc(this.position.x+this.width/2,this.position.y+this.style.thumbRadius+this.thumbFill,this.style.thumbRadius,0,a.Constant.TAU),t.fill()}paintLOD1(){let t=this.context;t.strokeStyle="#000",t.fillStyle=this.style.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height),t.fillRect(this.position.x,this.position.y,this.width,this.height)}offPaint(){this.offUIContext.fillStyle=this.hitColor.hexValue,this.offUIContext.fillRect(this.position.x,this.position.y,this.width,this.height)}reflow(){this.thumbFill=(0,n.denormalize)(1-(0,n.normalize)(this.value,this.min,this.max),0,this.height-2*this.style.thumbRadius),this.input&&this.input.position.assign(this.node.position.x-this.node.style.terminalStripMargin-this.input.style.radius,this.position.y+this.height/2),this.output&&this.output.position.assign(this.node.position.x+this.node.width+this.node.style.terminalStripMargin+this.output.style.radius,this.position.y+this.height/2)}onPropChange(t,i){this._value=i,this.reflow(),this.output&&this.output.setData(this.value)}onOver(t,i){this.disabled||this.call("over",this,t,i)}onDown(t,i){this.disabled||this.call("down",this,t,i)}onUp(t,i){this.disabled||this.call("up",this,t,i)}onClick(t,i){this.disabled||this.call("click",this,t,i)}onDrag(t,i){if(this.disabled)return;let e=this.position.x+this.width/2-this.style.railWidth/2;this.thumbFill=i.clamp(e,e,this.position.y+this.style.thumbRadius,this.position.y+this.height-this.style.thumbRadius).subtractInPlace(0,this.position.y+this.style.thumbRadius).y,this.value=(0,n.denormalize)(1-(0,n.normalize)(this.thumbFill,0,this.height-2*this.style.thumbRadius),this.min,this.max),this.call("drag",this,t,i)}onEnter(t,i){this.disabled||this.call("enter",this,t,i)}onExit(t,i){this.disabled||this.call("exit",this,t,i)}onWheel(t,i,e){this.disabled||this.call("wheel",this,t,i,e)}onContextMenu(){this.disabled}serialize(){return{min:this.min,max:this.max,value:this.value,propName:this.propName,input:this.input?this.input.serialize():null,output:this.output?this.output.serialize():null,height:this.height,width:this.width,style:this.style,id:this.id,hitColor:this.hitColor.serialize(),type:this.type,childs:[]}}static deSerialize(t,i){return new u(t,i.min,i.max,{value:i.value,propName:i.propName,input:i.input,output:i.output,height:i.height,width:i.width,style:i.style,id:i.id,hitColor:r.Color.deSerialize(i.hitColor)})}}i.VSlider=u;let d=(t,i)=>({color:"#444",thumbColor:"#000",railWidth:4,thumbRadius:void 0!==i?i/2:1.5*t.style.rowHeight/2}),p=t=>({height:5*t.style.rowHeight,width:t.style.rowHeight})},1141:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AVLTreeNode=i.AVLTree=void 0;i.AVLTree=class{constructor(t,i){this.comparator=t,this.dataToTreeNodeMapper=i,this.root=null,this.dataRefToTreeNode={},this.size=0}height(t){return t?t.height:0}rightRotate(t){let i=t.left;return t.left=i.right,i.right=t,t.height=Math.max(t.left?t.left.height:0,t.right?t.right.height:0)+1,i.height=Math.max(i.left?i.left.height:0,i.right?i.right.height:0)+1,i}leftRotate(t){let i=t.right;return t.right=i.left,i.left=t,t.height=Math.max(t.left?t.left.height:0,t.right?t.right.height:0)+1,i.height=Math.max(i.left?i.left.height:0,i.right?i.right.height:0)+1,i}getBalance(t){return t?(t.left?t.left.height:0)-(t.right?t.right.height:0):0}add(t){let i={node:null};return this.root=this._insert(this.root,t,i),this.dataRefToTreeNode[this.dataToTreeNodeMapper(t)]=i.node,this.size+=1,i.node}_insert(t,i,s){if(!t){let t=new e([i]);return s.node=t,t}if(0===this.comparator(i,t.data[0]))return t.data.push(i),s.node=t,t;this.comparator(i,t.data[0])<0?t.left=this._insert(t.left,i,s):t.right=this._insert(t.right,i,s),t.height=1+Math.max(t.left?t.left.height:0,t.right?t.right.height:0);let o=this.getBalance(t);return o>1&&this.comparator(i,t.left.data[0])<0?this.rightRotate(t):o>1&&this.comparator(i,t.left.data[0])>0?(t.left=this.leftRotate(t.left),this.rightRotate(t)):o<-1&&this.comparator(i,t.right.data[0])>0?this.leftRotate(t):o<-1&&this.comparator(i,t.right.data[0])<0?(t.right=this.rightRotate(t.right),this.leftRotate(t)):t}remove(t){let i={deleted:!1};return this.root=this._delete(this.root,t,i),delete this.dataRefToTreeNode[this.dataToTreeNodeMapper(t)],this.size-=1,i.deleted}_delete(t,i,e){if(!t)return t;if(this.comparator(i,t.data[0])<0)t.left=this._delete(t.left,i,e);else if(this.comparator(i,t.data[0])>0)t.right=this._delete(t.right,i,e);else{if(t.data.length>1){let s=t.data.findIndex((t=>this.dataToTreeNodeMapper(t)===this.dataToTreeNodeMapper(i)));return s>-1?(t.data.splice(s,1),e.deleted=!0):e.deleted=!1,t}if(t.left&&t.right){let i=this.minValue(t.right);t.data=i.data,t.right=this._delete(t.right,i.data[0],e),e.deleted=!0}else{let i=null;i=t.left?t.left:t.right,t=i||null,e.deleted=!0}}if(!t)return t;t.height=Math.max(t.left?t.left.height:0,t.right?t.right.height:0)+1;let s=this.getBalance(t);return s>1&&this.getBalance(t.left)>=0?this.rightRotate(t):s>1&&this.getBalance(t.left)<0?(t.left=this.leftRotate(t.left),this.rightRotate(t)):s<-1&&this.getBalance(t.right)<=0?this.leftRotate(t):s<-1&&this.getBalance(t.right)>0?(t.right=this.rightRotate(t.right),this.leftRotate(t)):t}minValue(t){let i=t;for(;i.left;)i=i.left;return i}forEach(t){this._inorder(this.root,t)}_inorder(t,i){null!==t&&(this._inorder(t.left,i),t.data.forEach((t=>i(t))),this._inorder(t.right,i))}_reverseInorder(t,i){null!==t&&(this._inorder(t.right,i),t.data.forEach((t=>i(t))),this._inorder(t.left,i))}};class e{constructor(t){this.data=t,this.height=1,this.left=null,this.right=null}}i.AVLTreeNode=e},296:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BiMap=void 0;i.BiMap=class{constructor(){this.map=new Map,this.reverseMap=new Map}get(t){return this.map.get(t)||this.reverseMap.get(t)}set(t,i){this.map.set(t,i),this.reverseMap.set(i,t)}has(t){return this.map.has(t)||this.reverseMap.has(t)}delete(t){let i=this.map.get(t),e=this.reverseMap.get(t);void 0!==i&&this.map.delete(t),void 0!==e&&this.reverseMap.delete(t),this.map.delete(i),this.reverseMap.delete(i),this.map.delete(e),this.reverseMap.delete(e)}clear(){this.map.clear(),this.reverseMap.clear()}}},9433:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Evaluator=void 0;const s=e(3814),o=e(3612),n=e(3855);class h{constructor(t){this.variables=t,this.history={},this.orderedExprs=[],this.historyLimit=3,this.parser=new n.Parser}evaluate(t,i){let e;if(this.history[t])e=this.history[t];else{if(this.orderedExprs.length===this.historyLimit){let t=this.orderedExprs.shift();delete this.history[t]}this.orderedExprs.push(t),this.history[t]=this.parser.parse(t),e=this.history[t]}let o=[];for(let t of e)switch(t.type){case s.TokenType.Literal:o.push(t.value);break;case s.TokenType.Variable:if(t.value!==t.value.toLowerCase()){if(!Array.isArray(this.variables[t.value]))throw new Error("Spread operator only allowed for array variables: "+t.value.toLowerCase());o.push(this.variables[t.value])}else Array.isArray(this.variables[t.value])&&void 0!==i?o.push(this.variables[t.value][i]):o.push(this.variables[t.value]);break;case s.TokenType.Operator:{let[i,e]=[o.pop(),o.pop()];if("number"!=typeof i||"number"!=typeof e)throw new Error("Only numbers are allowed for operators");switch(t.value){case"+":o.push(i+e);break;case"*":o.push(i*e);break;case"-":o.push(e-i);break;case"/":o.push(e/i);break;case"%":o.push(e%i);break;case"^":o.push(Math.pow(e,i));break;case"&":o.push(e&i);break;case"|":o.push(e|i);break;default:throw new Error("Unknow operator: "+t.value)}break}case s.TokenType.Function:{let i=[];for(let e=0;e<t.count;e+=1)i.push(o.pop());o.push(h.functions[t.value](...i));break}default:throw new Error("Unknown token type: "+t.type)}return o[0]}}i.Evaluator=h,h.constants={tau:o.Constant.TAU,pi:Math.PI,phi:o.Constant.PHI,ln2:Math.LN2,ln10:Math.LN10,log2e:Math.LOG2E,log10e:Math.LOG10E},h.functions={cos:Math.cos,acos:Math.acos,acosh:Math.acosh,sin:Math.sin,asin:Math.asin,asinh:Math.asinh,tan:Math.tan,atan:Math.atan,atanh:Math.atanh,atan2:Math.atan2,abs:Math.abs,ceil:Math.ceil,round:Math.round,floor:Math.floor,exp:Math.exp,random:Math.random,sqrt:Math.sqrt,cbrt:Math.cbrt,log10:Math.log10,log2:Math.log2,log:(t,i)=>i?Math.log(t)/Math.log(i):Math.log(t),dist:(t,i,e,s)=>Math.sqrt(Math.pow(e-t,2)+Math.pow(s-i,2)),gcd:(t,i)=>{for(;0!==i;){const e=t%i;t=i,i=e}return t<0?-t:t},max:(...t)=>Array.isArray(t[0])?Math.max(...t[0]):Math.max(...t),min:(...t)=>Array.isArray(t[0])?Math.min(...t[0]):Math.min(...t),hypot:(...t)=>{let i=0,e=0;return(Array.isArray(t[0])?t[0]:t).forEach((t=>{const s=Math.abs(t);e<s?(i=i*(e/s)*(e/s),i+=1,e=s):i+=s>0?s/e*(s/e):s})),e*Math.sqrt(i)},lcm:(t,i)=>{if(0===t)return t;if(0===i)return i;const e=t*i;for(;0!==i;){const e=i;i=t%e,t=e}return Math.abs(e/t)},sum:(...t)=>(Array.isArray(t[0])?t[0]:t).reduce(((t,i)=>t+i),0),mean:(...t)=>{let i=Array.isArray(t[0])?t[0]:t;return h.functions.sum(i)/i.length},median:(...t)=>{let i=Array.isArray(t[0])?t[0]:t;return i.sort(((t,i)=>t-i)),i.length%2==0?(i[i.length/2-1]+i[i.length/2])/2:i[Math.floor(i.length/2)]},std:(...t)=>{let i=Array.isArray(t[0])?t[0]:t;return Math.sqrt(h.functions.var(i))},var:(...t)=>{let i=Array.isArray(t[0])?t[0]:t,e=h.functions.mean(i);return i.reduce(((t,i)=>t+Math.pow(i-e,2)),0)/i.length},fact:t=>{let i=1;for(let e=t;e>1;e-=1)i*=e;return i}},h.multiargFunctions=["max","min","hypot","sum","mean","median","std","var"]},5928:function(t,i,e){var s=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e),Object.defineProperty(t,s,{enumerable:!0,get:function(){return i[e]}})}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),o=this&&this.__exportStar||function(t,i){for(var e in t)"default"===e||Object.prototype.hasOwnProperty.call(i,e)||s(i,t,e)};Object.defineProperty(i,"__esModule",{value:!0}),o(e(1141),i),o(e(9433),i),o(e(3814),i),o(e(8240),i),o(e(6645),i),o(e(3855),i),o(e(974),i),o(e(296),i)},3814:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Token=i.TokenType=i.Lexer=void 0;const s=e(9433);class o{constructor(){this.result=[],this.numberBuffer=[],this.letterBuffer=[]}tokenize(t){let i;for(this.result=[],this.numberBuffer=[],this.letterBuffer=[];-1!==(i=t.indexOf("..."));)t=t.substring(0,i)+t.charAt(i+3).toUpperCase()+t.substring(i+4);return(t=this.replaceConstants(t)).replace(/\s+/g,"").split("").forEach((t=>{if(this.isDigit(t))this.numberBuffer.push(t);else if(this.isDecimalPoint(t))this.numberBuffer.push(t);else if(this.isLetter(t))this.numberBuffer.length&&(this.processNumberBuffer(),this.result.push(new h(n.Operator,"*"))),this.letterBuffer.push(t);else if(this.isOperator(t))this.numberBuffer.length?this.processNumberBuffer():this.letterBuffer.length&&this.processLetterBuffer(),this.result.push(new h(n.Operator,t));else if(this.isLeftParenthesis(t))this.letterBuffer.length?(this.result.push(new h(n.Function,this.letterBuffer.join(""))),this.letterBuffer=[]):this.numberBuffer.length&&(this.processNumberBuffer(),this.result.push(new h(n.Operator,"*"))),this.result.push(new h(n.LParenthesis,t));else if(this.isRightParenthesis(t))this.letterBuffer.length&&this.processLetterBuffer(),this.numberBuffer.length&&this.processNumberBuffer(),this.result.push(new h(n.RParenthesis,t));else{if(!this.isComma(t))throw Error("Unknown character: "+t);this.numberBuffer.length&&this.processNumberBuffer(),this.letterBuffer.length&&this.processLetterBuffer(),this.result.push(new h(n.ArgSeperator,t))}})),this.numberBuffer.length&&this.processNumberBuffer(),this.letterBuffer.length&&this.processLetterBuffer(),this.result}replaceConstants(t){return t.replace(/pi/g,s.Evaluator.constants.pi.toString()).replace(/tau/g,s.Evaluator.constants.tau.toString()).replace(/phi/g,s.Evaluator.constants.phi.toString()).replace(/ln2/g,s.Evaluator.constants.ln2.toString()).replace(/ln10/g,s.Evaluator.constants.ln10.toString()).replace(/log2e/g,s.Evaluator.constants.log2e.toString()).replace(/log10e/g,s.Evaluator.constants.log10e.toString())}processNumberBuffer(){let t=parseFloat(this.numberBuffer.join(""));this.numberBuffer=[],isNaN(t)||this.result.push(new h(n.Literal,t))}processLetterBuffer(){for(var t=0;t<this.letterBuffer.length;t++)this.result.push(new h(n.Variable,this.letterBuffer[t])),t<this.letterBuffer.length-1&&this.result.push(new h(n.Operator,"*"));this.letterBuffer=[]}isComma(t){return","===t}isDigit(t){return/\d/.test(t)}isLetter(t){return/[a-zA-Z]/.test(t)}isOperator(t){return o.operators.includes(t)}isLeftParenthesis(t){return"("===t}isRightParenthesis(t){return")"==t}isDecimalPoint(t){return"."===t}}var n;i.Lexer=o,o.operators=["+","-","*","/","^","%","&","|"],function(t){t.Literal="Literal",t.Variable="Variable",t.Operator="Operator",t.LParenthesis="LParenthesis",t.RParenthesis="RParenthesis",t.Function="Function",t.ArgSeperator="ArgSeperator"}(n=i.TokenType||(i.TokenType={}));class h{constructor(t,i){this.type=t,this.value=i,this.count=0}get precedence(){return h.precedence[this.value]}get associativity(){return h.associativity[this.value]}toString(){return this.type+"("+this.value+")"}}i.Token=h,h.associativity={"^":"right","*":"left","/":"left","+":"left","-":"left","%":"left","&":"left","|":"left"},h.precedence={"|":0,"&":1,"+":2,"-":2,"*":3,"/":3,"%":3,"^":4}},8240:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ListNode=i.List=void 0;const s=e(7417);class o extends s.Hooks{constructor(t,i){super(),this.comparator=t,this.head=null,this.tail=null,this.length=0,i&&i.forEach((t=>this.append(t)))}prepend(t){let i=new n(t);return null===this.head?(this.head=i,this.tail=i):(this.head.prev=i,i.next=this.head,this.head=i),this.length+=1,this.call("prepend",this,i),i}append(t){let i=t instanceof n?t:new n(t);return null===this.tail?(this.head=i,this.tail=i):(this.tail.next=i,i.prev=this.tail,this.tail=i),this.length+=1,this.call("append",this,i),i}removeFirst(t=!0){let i;return null===this.head?null:(1===this.length?(i=this.head.data,this.head=null,this.tail=null):(i=this.head.data,this.head.next.prev=null,this.head=this.head.next),this.length-=1,t&&this.call("removefirst",this,i),i)}removeLast(){let t;return null===this.tail?null:(1===this.length?(t=this.tail.data,this.head=null,this.tail=null):(t=this.tail.data,this.tail.prev.next=null,this.tail=this.tail.prev),this.length-=1,this.call("removelast",this,t),t)}addAfter(t,i){let e=new n(t);return e.next=i.next,e.prev=i,i.next=e,e.next&&(e.next.prev=e),i===this.tail&&(this.tail=e),this.length+=1,e}addBefore(t,i){let e=new n(t);return e.prev=i.prev,e.next=i,i.prev=e,e.prev&&(e.prev.next=e),i===this.head&&(this.head=e),this.length+=1,e}delete(t){1===this.length?(this.head=null,this.tail=null):t===this.head?this.removeFirst():t===this.tail?this.removeLast():(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.length-=1)}searchHead(t){let i=this.head;for(;null!==i;){if(t(i))return i;i=i.next}return null}searchTail(t){let i=this.tail;for(;null!==i;){if(t(i))return i;i=i.prev}return null}get(t){if(t>=this.length)return null;if(0===t)return this.head?this.head.data:null;if(t===this.length-1)return this.tail?this.tail.data:null;{let i=0,e=this.head;for(;null!==e;){if(i===t)return e.data;i+=1,e=e.next}return null}}forEach(t){let i=this.head;for(;null!==i;)t(i),i=i.next}map(t){let i=[];return this.forEach((e=>i.push(t(e)))),i}toArray(){let t=[];return this.forEach((i=>t.push(i.data))),t}toString(){return this.toArray().join(", ")}}i.List=o;class n{constructor(t){this.prev=null,this.next=null,this.data=t||null}}i.ListNode=n},6645:(t,i)=>{var e;Object.defineProperty(i,"__esModule",{value:!0}),i.Log=i.LogLevel=void 0,function(t){t[t.TRACE=0]="TRACE",t[t.DEBUG=1]="DEBUG",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.LOG=3]="LOG",t[t.ERROR=4]="ERROR",t[t.DISABLED=5]="DISABLED"}(e=i.LogLevel||(i.LogLevel={}));class s{static trace(...t){this.LOG_LEVEL>e.TRACE||console.trace.apply(this,t)}static debug(...t){this.LOG_LEVEL>e.DEBUG||console.debug.apply(this,t)}static info(...t){this.LOG_LEVEL>e.INFO||console.info.apply(this,t)}static log(...t){this.LOG_LEVEL>e.LOG||console.log.apply(this,t)}static warn(...t){this.LOG_LEVEL>e.WARN||console.warn.apply(this,t)}static error(...t){this.LOG_LEVEL>e.ERROR||console.error.apply(this,t)}}i.Log=s,s.LOG_LEVEL=e.INFO},3855:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Parser=void 0;const s=e(3814);i.Parser=class{constructor(){this.lexer=new s.Lexer}peek(t){return t.slice(-1)[0]}parse(t){let i=this.lexer.tokenize(t),e=[],o=[],n=[],h=[];for(i.forEach((t=>{if(t.type===s.TokenType.Literal||t.type===s.TokenType.Variable)o.push(t),void 0!==this.peek(n)&&(n.pop(),n.push(!0));else if(t.type===s.TokenType.Function)e.push(t),h.push(0),void 0!==this.peek(n)&&(n.pop(),n.push(!0)),n.push(!1);else if(t.type===s.TokenType.ArgSeperator){for(;this.peek(e)&&this.peek(e).type!==s.TokenType.LParenthesis;)o.push(e.pop());n.pop()&&h.push(h.pop()+1),n.push(!1)}else if(t.type==s.TokenType.Operator){for(;this.peek(e)&&this.peek(e).type===s.TokenType.Operator&&("left"===t.associativity&&t.precedence<=this.peek(e).precedence||"right"===t.associativity&&t.precedence<this.peek(e).precedence);)o.push(e.pop());e.push(t)}else if(t.type===s.TokenType.LParenthesis)e.push(t);else if(t.type===s.TokenType.RParenthesis){for(;this.peek(e)&&this.peek(e).type!==s.TokenType.LParenthesis;)o.push(e.pop());if(e.pop(),this.peek(e)&&this.peek(e).type===s.TokenType.Function){let t=e.pop(),i=h.pop();n.pop()&&(i+=1),t.count=i,o.push(t)}}}));this.peek(e);)o.push(e.pop());return o}}},974:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.binarySearch=i.get=i.exists=i.isInRange=i.isEmpty=i.canConnect=i.lerp=i.clamp=i.intersects=i.getRandom=i.denormalize=i.normalize=i.getNewUUID=void 0;const s=e(712);i.getNewUUID=()=>{var t=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return t()+"-"+t()+"-"+t()+"-"+t()};i.normalize=(t,i,e)=>i===e?1:(t-i)/(e-i);i.denormalize=(t,i,e)=>(e-i)*t+i;i.getRandom=(t,i)=>Math.random()*(i-t)+t;i.intersects=(t,i,e,o,n,h,r,l)=>!(n>e||r<t||h>o||l<i)?n<t||h<i||r>e||l>o?s.ViewPort.INTERSECT:s.ViewPort.INSIDE:s.ViewPort.OUTSIDE;i.clamp=(t,i,e)=>Math.min(Math.max(t,i),e);i.lerp=(t,i,e)=>(1-e)*t+e*i;i.canConnect=(t,i,e,s)=>!!i&&(t!==i&&(t.node!==i.node&&(t.type!==i.type&&(!!e[t.dataType].includes(i.dataType)&&!!s.canConnect(t.node,i.node)))));i.isEmpty=t=>{for(let i in t)return!1;return!0};i.isInRange=(t,i,e)=>Math.min(t,i)>=i&&Math.max(t,e)<=e;i.exists=t=>null!=t;i.get=(t,i)=>null==t?i:t;i.binarySearch=({max:t,getValue:i,match:e})=>{let s=0;for(;s<=t;){let o=Math.floor((s+t)/2);const n=i(o);if(n===e)return o;n<e?s=o+1:t=o-1}return t}}},e={};function s(t){var o=e[t];if(void 0!==o)return o.exports;var n=e[t]={exports:{}};return i[t].call(n.exports,n,n.exports,s),n.exports}s.m=i,t=[],s.O=(i,e,o,n)=>{if(!e){var h=1/0;for(u=0;u<t.length;u++){for(var[e,o,n]=t[u],r=!0,l=0;l<e.length;l++)(!1&n||h>=n)&&Object.keys(s.O).every((t=>s.O[t](e[l])))?e.splice(l--,1):(r=!1,n<h&&(h=n));if(r){t.splice(u--,1);var a=o();void 0!==a&&(i=a)}}return i}n=n||0;for(var u=t.length;u>0&&t[u-1][2]>n;u--)t[u]=t[u-1];t[u]=[e,o,n]},s.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{var t={833:0};s.O.j=i=>0===t[i];var i=(i,e)=>{var o,n,[h,r,l]=e,a=0;if(h.some((i=>0!==t[i]))){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(l)var u=l(s)}for(i&&i(e);a<h.length;a++)n=h[a],s.o(t,n)&&t[n]&&t[n][0](),t[h[a]]=0;return s.O(u)},e=self.webpackChunkflow_connect=self.webpackChunkflow_connect||[];e.forEach(i.bind(null,0)),e.push=i.bind(null,e.push.bind(e))})();var o=s(6184);return o=s.O(o)})()}));
//# sourceMappingURL=flow-connect.js.map